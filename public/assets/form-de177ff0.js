import{t as N,v as j,A as C,x as k,n as Q,r as h,d as Y,q as b,p as w,Q as D,a as I,j as c,L as O,I as F,b as G,o as R}from"./index-2d95d8aa.js";import{S as $}from"./select-281589a8.js";import{T as A}from"./text-area-0fa0c908.js";import{a as z,A as T}from"./assigned-vehicle-22992cd2.js";import{Y as M}from"./validations-15e32238.js";import{u as B}from"./vehicle-96ca185b.js";import{u as H}from"./employee-1ba529c6.js";import"./useQuery-9ab57199.js";const K=N().shape({operationType:j().required("El tipo de operacion es requerido!"),daysService:C().min(1,"debe ser mayor o igual que 1").required("los dias de servicios son requeridos!"),observations:j().required("La observacion es requerida!"),vehicle:M.required("El vehiculo es requerido!"),employee:M.required("El empleado es requerido!")}),P={operationType:"",daysService:0,observations:""};function U(){const s=k(),f=Q(),{assigned:e,isLoading:x}=z(),g=h.useMemo(()=>{var o,i,l,r,d,u,y;return{daysService:(e==null?void 0:e.daysService)||0,observations:(e==null?void 0:e.observations)||"",operationType:(e==null?void 0:e.operationType)||"",employee:{id:((o=e==null?void 0:e.employee)==null?void 0:o.id)||"",value:((i=e==null?void 0:e.employee)==null?void 0:i.id)||" ",label:`${(l=e==null?void 0:e.employee)==null?void 0:l.identification} - ${(r=e==null?void 0:e.employee)==null?void 0:r.name} ${e==null?void 0:e.employee.lastName}`},vehicle:{id:((d=e==null?void 0:e.vehicle)==null?void 0:d.id)||"",value:((u=e==null?void 0:e.vehicle)==null?void 0:u.id)||"",label:((y=e==null?void 0:e.vehicle)==null?void 0:y.plate)||""}}},[e]),m=Y(),t=h.useCallback(async o=>{var i,l;try{await T.editAssignedVehicle(s.id||"",{...o,vehicle:(i=o==null?void 0:o.vehicle)==null?void 0:i.id,employee:(l=o==null?void 0:o.employee)==null?void 0:l.id}),b("Vehiculo actualizado exitosamente",null)}catch(r){b(`opps!! algo no va bien ${r.response.data.message||""}`,"error"),console.error(r)}},[s]),n=h.useCallback(async o=>{var i,l;try{const r=await T.createAssignedVehicle({...o,vehicle:(i=o==null?void 0:o.vehicle)==null?void 0:i.id,employee:(l=o==null?void 0:o.employee)==null?void 0:l.id});return b("Vehiculo creado exitosamente",null),m("/employee/assigned"),r}catch(r){b(`opps!! algo no va bien ${r.response.data.message||""}`,"error"),console.error(r)}},[m]),{mutateAsync:S,isLoading:p}=w(s.id?t:n,{onSuccess:()=>{f.invalidateQueries([D.ASSIGNED])}});return{isLoading:x||p,submit:S,formValues:{defaultValues:s.id?g:P},status:s!=null&&s.id?"Editar assignacion":"Crear assignacion",isEditing:!!s.id}}const ie=()=>{var r,d,u,y,v,V,E,L,q;const{submit:s,isLoading:f,formValues:{defaultValues:e},status:x}=U(),{handleSubmit:g,reset:m,formState:{errors:t},control:n}=I({mode:"all",defaultValues:e,resolver:R(K)});h.useEffect(()=>{m(e)},[m,e]);const S=a=>{s(a)},{vehicles:p,isLoading:o}=B(),{employees:i,isLoading:l}=H();return f||o||l?c.jsx(O,{}):c.jsxs("form",{onSubmit:g(S),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[c.jsx(F,{control:n,name:"daysService",label:"Dias de servicio",type:"number",errorMessage:((r=t.daysService)==null?void 0:r.message)||"",error:!!t.daysService}),c.jsxs("div",{className:"flex gap-4",children:[c.jsx($,{control:n,name:"vehicle",options:((d=p==null?void 0:p.results)==null?void 0:d.map(a=>({id:a.id,label:a.plate,value:a.id})))||[],errorMessage:((y=(u=t.vehicle)==null?void 0:u.label)==null?void 0:y.message)||"",placeholder:"Vehiculo"}),c.jsx($,{control:n,name:"employee",options:((v=i==null?void 0:i.results)==null?void 0:v.map(a=>({id:a.id,label:`${a.identification} - ${a.name} ${a.lastName}`,value:a.id})))||[],errorMessage:((E=(V=t.employee)==null?void 0:V.label)==null?void 0:E.message)||"",placeholder:"Empleado"})]}),c.jsx(A,{control:n,name:"operationType",label:"Tipo de operacion",errorMessage:((L=t.operationType)==null?void 0:L.message)||"",error:!!t.operationType}),c.jsx(A,{control:n,name:"observations",label:"Observaciones",errorMessage:((q=t.observations)==null?void 0:q.message)||"",error:!!t.observations}),c.jsx(G.Button,{type:"submit",className:"mt-10",children:x})]})};export{ie as default};
