import{r as l,j as n,a3 as O,a5 as L,a6 as N,a as b,n as w,o as x,q as S,k,b as q,m as y,l as $,s as v,e as C,t as I}from"./index-dea8633d.js";import{S as V}from"./select-d9d190df.js";import{T as M}from"./text-area-62534bde.js";import{Q as z}from"./query-keys-9f424c63.js";import{a as R,O as j}from"./observation-e753dc2c.js";import{Y as F}from"./validations-c4aff704.js";import{u as Q}from"./employee-c7c12c41.js";function E(){const{innerWidth:t,innerHeight:o}=window;return{width:t,height:o}}function T(){const[t,o]=l.useState(E());return l.useEffect(()=>{function e(){o(E())}return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),t}const W=({control:t,name:o="",errorMessage:e,...p})=>{const[D,c]=l.useState([{startDate:new Date,endDate:new Date,key:"selection"}]),{width:d}=T();return n.jsxs("div",{className:"flex flex-col w-full",children:[n.jsx(O,{render:({field:i})=>{const m=Object.values(i.value)[0].length!==0?[{startDate:new Date(i.value.startDate),endDate:new Date(i.value.endDate),key:"selection"}]:D;return l.createElement(L.DateRangePicker,{...p,key:o,editableDateInputs:!0,locale:N.es,onChange:a=>{c([{endDate:a.selection.endDate||new Date,startDate:a.selection.startDate||new Date,key:"selection"}]),i.onChange(a.selection)},moveRangeOnFirstSelection:!1,months:d<=750?1:2,ranges:m,direction:"horizontal",className:"w-full h-full",color:"#000"})},control:t,name:o}),n.jsx(b.Typography,{className:"text-red-400 text-xs italic",children:e})]})},Y=w().shape({employeeId:F.required("El empleado es requerido!"),observation:x().required("La observacion es requerida!"),date:w().shape({startDate:x().required(),endDate:x().required()}).required("Las fechas son requieridas")}),H={observation:"",date:{startDate:"",endDate:""}};function P(){const t=S(),o=k(),{observation:e,isLoading:p}=R(),D=l.useMemo(()=>{var a,r,s,f,h;return{observation:(e==null?void 0:e.observation)||"",date:{startDate:(e==null?void 0:e.initDate)||"",endDate:(e==null?void 0:e.endDate)||"",selection:"selection"},employeeId:{id:((a=e==null?void 0:e.employee)==null?void 0:a.id)||"",value:((r=e==null?void 0:e.employee)==null?void 0:r.id)||"",label:`${(s=e==null?void 0:e.employee)==null?void 0:s.identification} - ${(f=e==null?void 0:e.employee)==null?void 0:f.name} ${(h=e==null?void 0:e.employee)==null?void 0:h.lastName}`}}},[e]),c=q(),d=l.useCallback(async a=>{var r;try{await j.editObservation(t.id||"",{...a,employeeId:(r=a==null?void 0:a.employeeId)==null?void 0:r.id,date:{endDate:a.date.endDate,startDate:a.date.startDate}}),y("Observacion actualizado exitosamente",null)}catch(s){y(`opps!! algo no va bien ${s.response.data.message||""}`,"error"),console.error(s)}},[t]),i=l.useCallback(async a=>{var r;try{const s=await j.createObservation({...a,employeeId:(r=a==null?void 0:a.employeeId)==null?void 0:r.id,date:{endDate:a.date.endDate,startDate:a.date.startDate}});return y("Observacion creada exitosamente",null),c("/employee/observations"),s}catch(s){y(`opps!! algo no va bien ${s.response.data.message||""}`,"error"),console.error(s)}},[c]),{mutateAsync:g,isLoading:m}=$(t.id?d:i,{onSuccess:()=>{o.invalidateQueries([z.VEHICLE])}});return{isLoading:p||m,submit:g,formValues:{defaultValues:t.id?D:H},status:t.id?"Editar Observacion":"Crear Observacion",isEditing:!!t.id}}const X=()=>{var r,s,f,h;const{submit:t,isLoading:o,formValues:{defaultValues:e},status:p}=P(),{handleSubmit:D,reset:c,formState:{errors:d},control:i}=v({mode:"all",defaultValues:e,resolver:I(Y)});l.useEffect(()=>{c(e)},[c,e]);const g=u=>{t(u)},{employees:m,isLoading:a}=Q();return o||a?n.jsx(C,{}):n.jsxs("form",{onSubmit:D(g),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[n.jsx("div",{className:"flex gap-4",children:n.jsx(M,{control:i,name:"observation",label:"Observacion",errorMessage:((r=d.observation)==null?void 0:r.message)||"",error:!!d.observation})}),n.jsx("div",{className:"flex gap-4",children:n.jsx(V,{control:i,name:"employeeId",options:((s=m==null?void 0:m.results)==null?void 0:s.map(u=>({id:u.id,label:`${u.identification} - ${u.name} ${u.lastName}`,value:u.id})))||[],errorMessage:((h=(f=d.employeeId)==null?void 0:f.label)==null?void 0:h.message)||"",placeholder:"Empleado"})}),n.jsxs("div",{className:"w-full",children:[n.jsx(b.Typography,{variant:"h4",className:`${d.date?"text-red-300":""}`,children:"Fechas de inicio y salida"}),n.jsx(W,{control:i,name:"date",errorMessage:d.date?"las fechas de inico y salida son requieridas":""})]}),n.jsx(b.Button,{type:"submit",className:"mt-10",children:p})]})};export{X as default};
