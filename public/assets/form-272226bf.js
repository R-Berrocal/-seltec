import{v as H,w as x,x as K,y as U,n as _,b as w,d as B,r as h,t as E,p as z,Q as J,a as T,j as o,L as W,I as L,c as X,o as Z}from"./index-8bd41d8c.js";import{S}from"./select-bf3dd5aa.js";import{a as v,E as P}from"./employee-8e6cc6a7.js";import{Y as C}from"./validations-9d99f41c.js";import{a as ee}from"./company-0fdbedc3.js";import{u as re}from"./group-4f01f2fd.js";import{u as se}from"./role-81a6f1b5.js";import{A as oe}from"./alert-48c44e81.js";import"./useQuery-d0771aa7.js";const ie=H().shape({name:x().required("El nombre es requerido!"),lastName:x().required("El apellido es requerido!"),email:x().required("El correo electronico es requerido!"),identification:x().required("La identificacion es requerida!").matches(/^\d+$/,"Solo deben ser numeros"),role:C.required("El rol es requerido!"),company:C.required("La empresa es requirida"),groups:K().of(C.required("Los grupos son requeridos!")).required("Los grupos son requeridos!")}),ae={name:"",lastName:"",email:"",identification:"",groups:[]};function te(){const d=U(),j=_(),{employee:e,isLoading:g}=v(),{user:f,showAlert:q}=w(),p=B(),a=h.useMemo(()=>{var s,n,c,i,t,l,b;return{name:(e==null?void 0:e.name)||"",lastName:(e==null?void 0:e.lastName)||"",email:(e==null?void 0:e.email)||"",identification:(e==null?void 0:e.identification)||"",role:{value:((s=e==null?void 0:e.roleEmployee)==null?void 0:s.id)||"",label:((n=e==null?void 0:e.roleEmployee)==null?void 0:n.name)||"",id:((c=e==null?void 0:e.roleEmployee)==null?void 0:c.id)||""},company:{id:((i=e==null?void 0:e.company)==null?void 0:i.id)||"",label:((t=e==null?void 0:e.company)==null?void 0:t.name)||"",value:((l=e==null?void 0:e.company)==null?void 0:l.id)||""},groups:((b=e==null?void 0:e.groups)==null?void 0:b.map(m=>({label:(m==null?void 0:m.name)||"",id:(m==null?void 0:m.id)||"",value:(m==null?void 0:m.id)||""})))||[]}},[e]),u=h.useCallback(async s=>{var n,c,i;try{await P.editEmployee(d.id||"",{...s,groups:(n=s==null?void 0:s.groups)==null?void 0:n.map(t=>t==null?void 0:t.id),role:(c=s==null?void 0:s.role)==null?void 0:c.value,company:(i=s==null?void 0:s.company)==null?void 0:i.value}),p("/employee/employees"),E("Empleado editado de forma correcta",null)}catch(t){E(`opps!! algo no va bien ${t.response.data.message||""}`,"error"),console.error(t)}},[d,p]),N=h.useCallback(async s=>{var n,c;try{const i=await P.createEmployee({...s,groups:s.groups.map(t=>t.id),role:(n=s==null?void 0:s.role)==null?void 0:n.value,company:(c=s==null?void 0:s.company)==null?void 0:c.value});return E("Empleado creado",null),i}catch(i){E(`opps!! algo no va bien ${i.response.data.message||""}`,"error"),console.error(i)}},[]),{mutateAsync:y,isLoading:M}=z(d.id?u:N,{onSuccess:s=>{if(j.invalidateQueries([J.EMPLOYEE]),(f==null?void 0:f.role)==="ADMIN"){q(s.id);return}p(-1)}});return{isLoading:g||M,submit:y,formValues:{defaultValues:d.id?a:ae},status:d.id?"Editar empleado":"Crear empleado",isEditing:!!d.id}}const be=()=>{var A,$,D,V,I,R,Y,k,Q,F,G,O;const{user:d}=w(),{submit:j,isLoading:e,formValues:{defaultValues:g},status:f}=te(),{handleSubmit:q,reset:p,formState:{errors:a},control:u}=T({mode:"all",defaultValues:g,resolver:Z(ie)}),{id:N,closeAlert:y,showDrawer:M}=w(),s=B(),{companies:n,isLoading:c}=ee(),{groups:i,isLoading:t}=re(),{roles:l,isLoading:b}=se();h.useEffect(()=>{p(g)},[p,g]);const m=r=>{j(r)};return e||c||t||b?o.jsx(W,{}):o.jsxs(o.Fragment,{children:[o.jsxs("form",{onSubmit:q(m),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[o.jsxs("div",{className:"flex gap-4",children:[o.jsx(L,{control:u,name:"name",label:"Nombre",errorMessage:((A=a.name)==null?void 0:A.message)||"",error:!!a.name}),o.jsx(L,{control:u,name:"lastName",label:"Apellido",errorMessage:(($=a.lastName)==null?void 0:$.message)||"",error:!!a.lastName})]}),o.jsxs("div",{className:"flex gap-4",children:[o.jsx(L,{control:u,name:"email",label:"Correo electronico",type:"email",errorMessage:((D=a.email)==null?void 0:D.message)||"",error:!!a.email}),o.jsx(L,{control:u,type:"number",name:"identification",label:"Identificacion",errorMessage:((V=a.identification)==null?void 0:V.message)||"",error:!!a.identification})]}),o.jsx("div",{className:"flex gap-4",children:o.jsx(S,{control:u,name:"company",options:((I=n==null?void 0:n.results)==null?void 0:I.map(r=>({id:r==null?void 0:r.id,label:r==null?void 0:r.name,value:r==null?void 0:r.id})))||[],placeholder:"Empresa",errorMessage:((Y=(R=a.company)==null?void 0:R.label)==null?void 0:Y.message)||""})}),o.jsxs("div",{className:"flex gap-4",children:[o.jsx(S,{control:u,name:"groups",isMulti:!0,options:((k=i==null?void 0:i.results)==null?void 0:k.map(r=>({id:r==null?void 0:r.id,label:r==null?void 0:r.name,value:r==null?void 0:r.id})))||[],placeholder:"Bloque",errorMessage:((Q=a.groups)==null?void 0:Q.message)||""}),o.jsx(S,{control:u,name:"role",options:((F=l==null?void 0:l.results)==null?void 0:F.map(r=>({id:r==null?void 0:r.id,label:r==null?void 0:r.name,value:r==null?void 0:r.id})))||[],placeholder:"Cargo",errorMessage:((O=(G=a.role)==null?void 0:G.label)==null?void 0:O.message)||""})]}),o.jsx(X.Button,{type:"submit",className:"mt-10",children:f})]}),(d==null?void 0:d.role)==="ADMIN"&&o.jsx(oe,{acction:()=>{s(`/employee/employees/info/${N}`),y(),M()},isRemove:!1,title:"Desea agregar una observacion al empleado creado?",description:"Dele 'confirmar' si es asi, en caso contrario dele cancelar."})]})};export{be as default};
