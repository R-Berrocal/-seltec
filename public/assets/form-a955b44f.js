import{v as M,w as P,y as S,n as C,r as p,d as N,t as d,p as $,Q as k,a as q,j as t,L as Q,I as u,c as I,o as z}from"./index-8bd41d8c.js";import{S as A}from"./select-bf3dd5aa.js";import{a as D,V as E}from"./vehicle-a0a4b2b6.js";import{a as F}from"./company-0fdbedc3.js";import"./useQuery-d0771aa7.js";const H=M().shape({plate:P().required("La placa es requerida!").max(6,"solo pueden ser 6 digitos").matches(/^[aA-zZ0-9]{6}$/,{message:"placa no valida"})}),R={plate:"",type:"",model:"",trailerPlate:"",owner:""};function Y(){const i=S(),g=C(),{vehicle:e,isLoading:f}=D(),y=p.useMemo(()=>{var a,o,r;return{plate:(e==null?void 0:e.plate)||"",type:(e==null?void 0:e.type)||"",model:(e==null?void 0:e.model)||"",trailerPlate:(e==null?void 0:e.trailerPlate)||"",owner:(e==null?void 0:e.owner)||"",company:{id:((a=e==null?void 0:e.company)==null?void 0:a.id)||"",label:((o=e==null?void 0:e.company)==null?void 0:o.name)||"",value:((r=e==null?void 0:e.company)==null?void 0:r.id)||""}}},[e]),m=N(),s=p.useCallback(async a=>{var o;try{await E.editVehicle(i.id||"",{...a,company:(o=a==null?void 0:a.company)==null?void 0:o.value}),m("/vehicles"),d("Vehiculo actualizado exitosamente",null)}catch(r){d(`opps!! algo no va bien ${r.response.data.message||""}`,"error"),console.error(r)}},[i,m]),l=p.useCallback(async a=>{var o;try{const r=await E.createVehicle({...a,company:(o=a==null?void 0:a.company)==null?void 0:o.value});return d("Vehiculo creado exitosamente",null),m("/vehicles"),r}catch(r){d(`opps!! algo no va bien ${r.response.data.message||""}`,"error"),console.error(r)}},[m]),{mutateAsync:x,isLoading:c}=$(i.id?s:l,{onSuccess:()=>{g.invalidateQueries([k.VEHICLE])}});return{isLoading:f||c,submit:x,formValues:{defaultValues:i.id?y:R},status:i.id?"Editar vehiculo":"Crear vehiculo",isEditing:!!i.id}}const U=()=>{var o,r,b,V,j,L,h,w;const{submit:i,isLoading:g,formValues:{defaultValues:e},status:f}=Y(),{handleSubmit:y,reset:m,formState:{errors:s},control:l}=q({mode:"all",defaultValues:e,resolver:z(H)});p.useEffect(()=>{m(e)},[m,e]);const x=n=>{i(n)},{companies:c,isLoading:a}=F();return g||a?t.jsx(Q,{}):t.jsxs("form",{onSubmit:y(x),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[t.jsxs("div",{className:"flex gap-4",children:[t.jsx(u,{control:l,name:"plate",label:"Placa",errorMessage:((o=s.plate)==null?void 0:o.message)||"",error:!!s.plate}),t.jsx(u,{control:l,name:"type",label:"Tipo",errorMessage:((r=s.type)==null?void 0:r.message)||"",error:!!s.type})]}),t.jsxs("div",{className:"flex gap-4",children:[t.jsx(u,{control:l,name:"model",label:"Modelo",errorMessage:((b=s.model)==null?void 0:b.message)||"",error:!!s.model}),t.jsx(u,{control:l,name:"trailerPlate",label:"Placa de remolque",errorMessage:((V=s.trailerPlate)==null?void 0:V.message)||"",error:!!s.trailerPlate})]}),t.jsx("div",{className:"flex gap-4",children:t.jsx(u,{control:l,name:"owner",label:"DueÃ±o",errorMessage:((j=s.owner)==null?void 0:j.message)||"",error:!!s.owner})}),t.jsx(A,{control:l,name:"company",options:((L=c==null?void 0:c.results)==null?void 0:L.map(n=>({id:n==null?void 0:n.id,label:n==null?void 0:n.name,value:n==null?void 0:n.id})))||[],errorMessage:((w=(h=s.company)==null?void 0:h.label)==null?void 0:w.message)||"",placeholder:"Empresa"}),t.jsx(I.Button,{type:"submit",className:"mt-10",children:f})]})};export{U as default};
