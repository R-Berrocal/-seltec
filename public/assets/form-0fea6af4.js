import{n as R,o as N,p as G,q as B,k as D,u as Q,r as h,b as F,m as j,l as H,s as K,j as o,e as U,I as y,a as _,t as z}from"./index-dea8633d.js";import{S as V}from"./select-d9d190df.js";import{Q as J}from"./query-keys-9f424c63.js";import{a as T,E as P}from"./employee-c7c12c41.js";import{Y}from"./validations-c4aff704.js";import{a as W}from"./company-6570ec82.js";import{u as X}from"./group-bcf359f5.js";import{u as Z}from"./role-dbce940e.js";const v=R().shape({name:N().required("El nombre es requerido!"),lastName:N().required("El apellido es requerido!"),email:N().required("El correo electronico es requerido!"),identification:N().required("La identificacion es requerida!"),role:Y.required("El rol es requerido!"),company:Y.required("La empresa es requerida!"),groups:G().of(Y.required("Los grupos son requeridos!")).required("Los grupos son requeridos!")}),ee={name:"",lastName:"",email:"",identification:"",groups:[]};function re(){const d=B(),M=D(),{employee:e,isLoading:l}=T(),{user:u}=Q(),C=h.useMemo(()=>{var s,c,t,n,a,b,E,x,L,q;return{name:(e==null?void 0:e.name)||"",lastName:(e==null?void 0:e.lastName)||"",email:(e==null?void 0:e.email)||"",identification:(e==null?void 0:e.identification)||"",role:{value:((s=e==null?void 0:e.roleEmployee)==null?void 0:s.id)||"",label:((c=e==null?void 0:e.roleEmployee)==null?void 0:c.name)||"",id:((t=e==null?void 0:e.roleEmployee)==null?void 0:t.id)||""},company:(u==null?void 0:u.role)==="COMPANY"?{label:((n=u.company)==null?void 0:n.id)||"",value:((a=u.company)==null?void 0:a.id)||"",id:((b=u.company)==null?void 0:b.id)||""}:{id:((E=e==null?void 0:e.company)==null?void 0:E.id)||"",label:((x=e==null?void 0:e.company)==null?void 0:x.name)||"",value:((L=e==null?void 0:e.company)==null?void 0:L.id)||""},groups:((q=e==null?void 0:e.groups)==null?void 0:q.map(m=>({label:(m==null?void 0:m.name)||"",id:(m==null?void 0:m.id)||"",value:(m==null?void 0:m.id)||""})))||[]}},[e,u]),g=F(),i=h.useCallback(async s=>{var c,t,n;try{await P.editEmployee(d.id||"",{...s,groups:(c=s==null?void 0:s.groups)==null?void 0:c.map(a=>a==null?void 0:a.id),role:(t=s==null?void 0:s.role)==null?void 0:t.value,company:(n=s==null?void 0:s.company)==null?void 0:n.value}),j("Empleado editado de forma correcta",null)}catch(a){j(`opps!! algo no va bien ${a.response.data.message||""}`,"error"),console.error(a)}},[d]),p=h.useCallback(async s=>{var c,t;try{const n=await P.createEmployee({...s,groups:s.groups.map(a=>a.id),role:(c=s==null?void 0:s.role)==null?void 0:c.value,company:(t=s==null?void 0:s.company)==null?void 0:t.value});return j("Empleado creado",null),g("/employee/employees"),n}catch(n){j(`opps!! algo no va bien ${n.response.data.message||""}`,"error"),console.error(n)}},[g]),{mutateAsync:f,isLoading:S}=H(d.id?i:p,{onSuccess:()=>{M.invalidateQueries([J.EMPLOYEE])}});return{isLoading:l||S,submit:f,formValues:{defaultValues:d.id?C:ee},status:d.id?"Editar empleado":"Crear empleado",isEditing:!!d.id}}const ce=()=>{var b,E,x,L,q,m,k,$,w,A,I,O;const{user:d}=Q(),{submit:M,isLoading:e,formValues:{defaultValues:l},status:u}=re(),{handleSubmit:C,reset:g,formState:{errors:i},control:p}=K({mode:"all",defaultValues:l,resolver:z(v)}),{companies:f,isLoading:S}=W(),{groups:s,isLoading:c}=X(),{roles:t,isLoading:n}=Z();h.useEffect(()=>{g(l)},[g,l]);const a=r=>{M(r)};return e||S||c||n?o.jsx(U,{}):o.jsxs("form",{onSubmit:C(a),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[o.jsxs("div",{className:"flex gap-4",children:[o.jsx(y,{control:p,name:"name",label:"Nombre",errorMessage:((b=i.name)==null?void 0:b.message)||"",error:!!i.name}),o.jsx(y,{control:p,name:"lastName",label:"Apellido",errorMessage:((E=i.lastName)==null?void 0:E.message)||"",error:!!i.lastName})]}),o.jsxs("div",{className:"flex gap-4",children:[o.jsx(y,{control:p,name:"email",label:"Correo electronico",type:"email",errorMessage:((x=i.email)==null?void 0:x.message)||"",error:!!i.email}),o.jsx(y,{control:p,name:"identification",label:"Identificacion",errorMessage:((L=i.identification)==null?void 0:L.message)||"",error:!!i.identification})]}),o.jsx("div",{className:"flex gap-4",children:(d==null?void 0:d.role)==="ADMIN"&&o.jsx(V,{control:p,name:"company",options:((q=f==null?void 0:f.results)==null?void 0:q.map(r=>({id:r==null?void 0:r.id,label:r==null?void 0:r.name,value:r==null?void 0:r.id})))||[],placeholder:"Empresa",errorMessage:((k=(m=i.company)==null?void 0:m.label)==null?void 0:k.message)||""})}),o.jsxs("div",{className:"flex gap-4",children:[o.jsx(V,{control:p,name:"groups",isMulti:!0,options:(($=s==null?void 0:s.results)==null?void 0:$.map(r=>({id:r==null?void 0:r.id,label:r==null?void 0:r.name,value:r==null?void 0:r.id})))||[],placeholder:"Bloque",errorMessage:((w=i.groups)==null?void 0:w.message)||""}),o.jsx(V,{control:p,name:"role",options:((A=t==null?void 0:t.results)==null?void 0:A.map(r=>({id:r==null?void 0:r.id,label:r==null?void 0:r.name,value:r==null?void 0:r.id})))||[],placeholder:"Cargo",errorMessage:((O=(I=i.role)==null?void 0:I.label)==null?void 0:O.message)||""})]}),o.jsx(_.Button,{type:"submit",className:"mt-10",children:u})]})};export{ce as default};
