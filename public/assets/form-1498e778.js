import{t as H,v as L,w as K,x as U,n as _,c as Y,d as B,r as y,q as h,p as z,Q as J,a as T,j as i,L as W,I as j,b as X,o as Z}from"./index-a3a25342.js";import{S as w}from"./select-e9bf787b.js";import{a as v,E as F}from"./employee-426819b6.js";import{Y as G}from"./validations-c6e97305.js";import{a as ee}from"./company-a6f4b75b.js";import{u as re}from"./group-64f5ab61.js";import{u as oe}from"./role-017985da.js";import{A as se}from"./alert-d51f5bc6.js";import"./useQuery-28d0c69b.js";const ie=H().shape({name:L().required("El nombre es requerido!"),lastName:L().required("El apellido es requerido!"),email:L().required("El correo electronico es requerido!"),identification:L().required("La identificacion es requerida!").matches(/^\d+$/,"Solo deben ser numeros"),role:G.required("El rol es requerido!"),groups:K().of(G.required("Los grupos son requeridos!")).required("Los grupos son requeridos!")}),ae={name:"",lastName:"",email:"",identification:"",groups:[]};function te(){const t=U(),M=_(),{employee:e,isLoading:g}=v(),{user:s,showAlert:q}=Y(),x=B(),n=y.useMemo(()=>{var o,m,l,d,c,a,E,N,f,b;return{name:(e==null?void 0:e.name)||"",lastName:(e==null?void 0:e.lastName)||"",email:(e==null?void 0:e.email)||"",identification:(e==null?void 0:e.identification)||"",role:{value:((o=e==null?void 0:e.roleEmployee)==null?void 0:o.id)||"",label:((m=e==null?void 0:e.roleEmployee)==null?void 0:m.name)||"",id:((l=e==null?void 0:e.roleEmployee)==null?void 0:l.id)||""},company:(s==null?void 0:s.role)==="COMPANY"?{label:((d=s.company)==null?void 0:d.id)||"",value:((c=s.company)==null?void 0:c.id)||"",id:((a=s.company)==null?void 0:a.id)||""}:{id:((E=e==null?void 0:e.company)==null?void 0:E.id)||"",label:((N=e==null?void 0:e.company)==null?void 0:N.name)||"",value:((f=e==null?void 0:e.company)==null?void 0:f.id)||""},groups:((b=e==null?void 0:e.groups)==null?void 0:b.map(p=>({label:(p==null?void 0:p.name)||"",id:(p==null?void 0:p.id)||"",value:(p==null?void 0:p.id)||""})))||[]}},[e,s]),u=y.useCallback(async o=>{var m,l,d,c;try{await F.editEmployee(t.id||"",{...o,groups:(m=o==null?void 0:o.groups)==null?void 0:m.map(a=>a==null?void 0:a.id),role:(l=o==null?void 0:o.role)==null?void 0:l.value,company:(s==null?void 0:s.role)==="COMPANY"?((d=s.company)==null?void 0:d.id)||"":(c=o==null?void 0:o.company)==null?void 0:c.value}),h("Empleado editado de forma correcta",null)}catch(a){h(`opps!! algo no va bien ${a.response.data.message||""}`,"error"),console.error(a)}},[t,s]),A=y.useCallback(async o=>{var m,l,d;try{const c=await F.createEmployee({...o,groups:o.groups.map(a=>a.id),role:(m=o==null?void 0:o.role)==null?void 0:m.value,company:(s==null?void 0:s.role)==="COMPANY"?((l=s.company)==null?void 0:l.id)||"":(d=o==null?void 0:o.company)==null?void 0:d.value});return h("Empleado creado",null),c}catch(c){h(`opps!! algo no va bien ${c.response.data.message||""}`,"error"),console.error(c)}},[s]),{mutateAsync:C,isLoading:S}=z(t.id?u:A,{onSuccess:o=>{if(M.invalidateQueries([J.EMPLOYEE]),(s==null?void 0:s.role)==="ADMIN"){q(o.id);return}x(-1)}});return{isLoading:g||S,submit:C,formValues:{defaultValues:t.id?n:ae},status:t.id?"Editar empleado":"Crear empleado",isEditing:!!t.id}}const be=()=>{var f,b,p,D,$,I,O,P,V,R,k,Q;const{user:t}=Y(),{submit:M,isLoading:e,formValues:{defaultValues:g},status:s}=te(),{handleSubmit:q,reset:x,formState:{errors:n},control:u}=T({mode:"all",defaultValues:g,resolver:Z(ie)}),{id:A,closeAlert:C,showDrawer:S}=Y(),o=B(),{companies:m,isLoading:l}=ee(),{groups:d,isLoading:c}=re(),{roles:a,isLoading:E}=oe();y.useEffect(()=>{x(g)},[x,g]);const N=r=>{M(r)};return e||l||c||E?i.jsx(W,{}):i.jsxs(i.Fragment,{children:[i.jsxs("form",{onSubmit:q(N),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[i.jsxs("div",{className:"flex gap-4",children:[i.jsx(j,{control:u,name:"name",label:"Nombre",errorMessage:((f=n.name)==null?void 0:f.message)||"",error:!!n.name}),i.jsx(j,{control:u,name:"lastName",label:"Apellido",errorMessage:((b=n.lastName)==null?void 0:b.message)||"",error:!!n.lastName})]}),i.jsxs("div",{className:"flex gap-4",children:[i.jsx(j,{control:u,name:"email",label:"Correo electronico",type:"email",errorMessage:((p=n.email)==null?void 0:p.message)||"",error:!!n.email}),i.jsx(j,{control:u,type:"number",name:"identification",label:"Identificacion",errorMessage:((D=n.identification)==null?void 0:D.message)||"",error:!!n.identification})]}),(t==null?void 0:t.role)==="ADMIN"&&i.jsx("div",{className:"flex gap-4",children:i.jsx(w,{control:u,name:"company",options:(($=m==null?void 0:m.results)==null?void 0:$.map(r=>({id:r==null?void 0:r.id,label:r==null?void 0:r.name,value:r==null?void 0:r.id})))||[],placeholder:"Empresa",errorMessage:((O=(I=n.company)==null?void 0:I.label)==null?void 0:O.message)||""})}),i.jsxs("div",{className:"flex gap-4",children:[i.jsx(w,{control:u,name:"groups",isMulti:!0,options:((P=d==null?void 0:d.results)==null?void 0:P.map(r=>({id:r==null?void 0:r.id,label:r==null?void 0:r.name,value:r==null?void 0:r.id})))||[],placeholder:"Bloque",errorMessage:((V=n.groups)==null?void 0:V.message)||""}),i.jsx(w,{control:u,name:"role",options:((R=a==null?void 0:a.results)==null?void 0:R.map(r=>({id:r==null?void 0:r.id,label:r==null?void 0:r.name,value:r==null?void 0:r.id})))||[],placeholder:"Cargo",errorMessage:((Q=(k=n.role)==null?void 0:k.label)==null?void 0:Q.message)||""})]}),i.jsx(X.Button,{type:"submit",className:"mt-10",children:s})]}),(t==null?void 0:t.role)==="ADMIN"&&i.jsx(se,{acction:()=>{o(`/employee/employees/info/${A}`),C(),S()},isRemove:!1,title:"Desea agregar una observacion al empleado creado?",description:"Dele 'confirmar' si es asi, en caso contrario dele cancelar."})]})};export{be as default};
