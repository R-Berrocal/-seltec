import{v,w as f,ae as P,m as w,y as I,n as M,r as m,d as C,ad as j,t as y,p as T,Q as k,a as Q,f as Y,j as t,L as F,c as S,o as B}from"./index-8bd41d8c.js";import{S as $}from"./select-bf3dd5aa.js";import{T as U}from"./text-area-cb59dc7e.js";import{D as z}from"./date-picker-3f94d72e.js";import{a as G}from"./observation-a1e94fcb.js";import{Y as H}from"./validations-9d99f41c.js";import{u as K}from"./employee-8e6cc6a7.js";import"./useQuery-d0771aa7.js";const _=v().shape({employeeId:H.required("El empleado es requerido!"),observation:f().required("La observacion es requerida!"),isApproved:v().shape({label:f().required("requerido!"),id:f().required("requerido!"),value:P().required("requerido!")}).required("El Estado es requerido!"),date:v().shape({startDate:f(),endDate:f()}).when("isApproved",(r,n)=>r[0].id==="APROVADO"?n.required("requerido"):n)}),L=w(),J={observation:"",date:{startDate:`${L}`,endDate:`${L.add(7,"day")}`}};function W(){const r=I(),n=M(),{observation:e,isLoading:D}=G(),u=m.useMemo(()=>{var a,i,s,c,O;return{observation:(e==null?void 0:e.observation)||"",date:{startDate:(e==null?void 0:e.initDate)||"",endDate:(e==null?void 0:e.endDate)||"",selection:"selection"},employeeId:{id:((a=e==null?void 0:e.employee)==null?void 0:a.id)||"",value:((i=e==null?void 0:e.employee)==null?void 0:i.id)||"",label:`${(s=e==null?void 0:e.employee)==null?void 0:s.identification} - ${(c=e==null?void 0:e.employee)==null?void 0:c.name} ${(O=e==null?void 0:e.employee)==null?void 0:O.lastName}`},isApproved:{id:e!=null&&e.isApproved?"APROVADO":"NOAPROVADO",label:e!=null&&e.isApproved?"APROVADO":"NO APROVADO",value:e==null?void 0:e.isApproved}}},[e]),l=C(),g=m.useCallback(async a=>{var i;try{await j.editObservation(r.id||"",{...a,employeeId:(i=a==null?void 0:a.employeeId)==null?void 0:i.id,date:{endDate:a.isApproved.value?a.date.endDate:void 0,startDate:a.isApproved.value?a.date.startDate:void 0},isApproved:a.isApproved.value}),l("/employee/observations"),y("Observacion actualizado exitosamente",null)}catch(s){y(`opps!! algo no va bien ${s.response.data.message||""}`,"error"),console.error(s)}},[r,l]),A=m.useCallback(async a=>{var i;try{const s=await j.createObservation({...a,employeeId:(i=a==null?void 0:a.employeeId)==null?void 0:i.id,date:{endDate:a.isApproved.value&&a.date.endDate||void 0,startDate:a.isApproved.value&&a.date.startDate||void 0},isApproved:a.isApproved.value});return y("Observacion creada exitosamente",null),l("/employee/observations"),s}catch(s){y(`opps!! algo no va bien ${s.response.data.message||""}`,"error"),console.error(s)}},[l]),{mutateAsync:d,isLoading:p}=T(r.id?g:A,{onSuccess:()=>{n.invalidateQueries([k.OBSERVATION])}});return{isLoading:D||p,submit:d,formValues:{defaultValues:r.id?u:J},status:r.id?"Editar Observacion":"Crear Observacion",isEditing:!!r.id}}const X=[{label:"APROVADO",value:!0,id:"APROVADO"},{label:"NO APROVADO",value:!1,id:"NOAPROVADO"}],de=()=>{var b,h,x,V,q,E;const[r,n]=m.useState(!1),{submit:e,isLoading:D,formValues:{defaultValues:u},status:l}=W(),{handleSubmit:g,reset:A,formState:{errors:d},control:p,watch:a}=Q({mode:"all",defaultValues:u,resolver:B(_)}),{pathname:i}=Y();m.useEffect(()=>{const o=a(R=>{var N;((N=R.isApproved)==null?void 0:N.value)===!0?n(!0):n(!1)});return()=>o.unsubscribe()},[a]),m.useEffect(()=>{A(u)},[A,u]);const s=o=>{e(o)},{employees:c,isLoading:O}=K();return D||O?t.jsx(F,{}):t.jsxs("form",{onSubmit:g(s),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[t.jsx($,{control:p,name:"isApproved",placeholder:"Estado",options:X,errorMessage:((h=(b=d.isApproved)==null?void 0:b.value)==null?void 0:h.message)||""}),t.jsx("div",{className:"flex gap-4",children:t.jsx(U,{control:p,name:"observation",label:"Observacion",errorMessage:((x=d.observation)==null?void 0:x.message)||"",error:!!d.observation})}),t.jsx("div",{className:"flex gap-4",children:!i.split("/").includes("info")&&t.jsx($,{control:p,name:"employeeId",options:((V=c==null?void 0:c.results)==null?void 0:V.map(o=>({id:o.id,label:`${o.identification} - ${o.name} ${o.lastName}`,value:o.id})))||[],errorMessage:((E=(q=d.employeeId)==null?void 0:q.label)==null?void 0:E.message)||"",placeholder:"Empleado"})}),r&&t.jsxs("div",{className:"w-full",children:[t.jsx(S.Typography,{variant:"h4",className:`${d.date?"text-red-300":""}`,children:"Fechas de inicio y salida"}),t.jsx(z,{control:p,name:"date",errorMessage:d.date?"las fechas de inico y salida son requieridas":""})]}),t.jsx(S.Button,{type:"submit",className:"mt-10",children:l})]})};export{de as default};
