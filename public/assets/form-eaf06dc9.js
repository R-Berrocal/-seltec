import{n as N,o as j,y as C,q as k,k as Q,r as h,b as Y,m as b,l as w,s as D,j as c,e as I,I as O,a as F,t as G}from"./index-dea8633d.js";import{S as $}from"./select-d9d190df.js";import{T}from"./text-area-62534bde.js";import{Q as R}from"./query-keys-9f424c63.js";import{a as z,A}from"./assigned-vehicle-c06f09ab.js";import{Y as M}from"./validations-c4aff704.js";import{u as B}from"./vehicle-15b1fae9.js";import{u as H}from"./employee-c7c12c41.js";const K=N().shape({operationType:j().required("El tipo de operacion es requerido!"),daysService:C().min(1,"debe ser mayor o igual que 1").required("los dias de servicios son requeridos!"),observations:j().required("La observacion es requerida!"),vehicle:M.required("El vehiculo es requerido!"),employee:M.required("El empleado es requerido!")}),P={operationType:"",daysService:0,observations:""};function U(){const a=k(),f=Q(),{assigned:e,isLoading:x}=z(),g=h.useMemo(()=>{var o,i,l,r,d,u,y;return{daysService:(e==null?void 0:e.daysService)||0,observations:(e==null?void 0:e.observations)||"",operationType:(e==null?void 0:e.operationType)||"",employee:{id:((o=e==null?void 0:e.employee)==null?void 0:o.id)||"",value:((i=e==null?void 0:e.employee)==null?void 0:i.id)||" ",label:`${(l=e==null?void 0:e.employee)==null?void 0:l.identification} - ${(r=e==null?void 0:e.employee)==null?void 0:r.name} ${e==null?void 0:e.employee.lastName}`},vehicle:{id:((d=e==null?void 0:e.vehicle)==null?void 0:d.id)||"",value:((u=e==null?void 0:e.vehicle)==null?void 0:u.id)||"",label:((y=e==null?void 0:e.vehicle)==null?void 0:y.plate)||""}}},[e]),m=Y(),t=h.useCallback(async o=>{var i,l;try{await A.editAssignedVehicle(a.id||"",{...o,vehicle:(i=o==null?void 0:o.vehicle)==null?void 0:i.id,employee:(l=o==null?void 0:o.employee)==null?void 0:l.id}),b("Vehiculo actualizado exitosamente",null)}catch(r){b(`opps!! algo no va bien ${r.response.data.message||""}`,"error"),console.error(r)}},[a]),n=h.useCallback(async o=>{var i,l;try{const r=await A.createAssignedVehicle({...o,vehicle:(i=o==null?void 0:o.vehicle)==null?void 0:i.id,employee:(l=o==null?void 0:o.employee)==null?void 0:l.id});return b("Vehiculo creado exitosamente",null),m("/employee/assigned"),r}catch(r){b(`opps!! algo no va bien ${r.response.data.message||""}`,"error"),console.error(r)}},[m]),{mutateAsync:S,isLoading:p}=w(a.id?t:n,{onSuccess:()=>{f.invalidateQueries([R.ASSIGNED])}});return{isLoading:x||p,submit:S,formValues:{defaultValues:a.id?g:P},status:a!=null&&a.id?"Editar assignacion":"Crear assignacion",isEditing:!!a.id}}const ie=()=>{var r,d,u,y,V,v,E,q,L;const{submit:a,isLoading:f,formValues:{defaultValues:e},status:x}=U(),{handleSubmit:g,reset:m,formState:{errors:t},control:n}=D({mode:"all",defaultValues:e,resolver:G(K)});h.useEffect(()=>{m(e)},[m,e]);const S=s=>{a(s)},{vehicles:p,isLoading:o}=B(),{employees:i,isLoading:l}=H();return f||o||l?c.jsx(I,{}):c.jsxs("form",{onSubmit:g(S),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[c.jsx(O,{control:n,name:"daysService",label:"Dias de servicio",type:"number",errorMessage:((r=t.daysService)==null?void 0:r.message)||"",error:!!t.daysService}),c.jsxs("div",{className:"flex gap-4",children:[c.jsx($,{control:n,name:"vehicle",options:((d=p==null?void 0:p.results)==null?void 0:d.map(s=>({id:s.id,label:s.plate,value:s.id})))||[],errorMessage:((y=(u=t.vehicle)==null?void 0:u.label)==null?void 0:y.message)||"",placeholder:"Vehiculo"}),c.jsx($,{control:n,name:"employee",options:((V=i==null?void 0:i.results)==null?void 0:V.map(s=>({id:s.id,label:`${s.identification} - ${s.name} ${s.lastName}`,value:s.id})))||[],errorMessage:((E=(v=t.employee)==null?void 0:v.label)==null?void 0:E.message)||"",placeholder:"Empleado"})]}),c.jsx(T,{control:n,name:"operationType",label:"Tipo de operacion",errorMessage:((q=t.operationType)==null?void 0:q.message)||"",error:!!t.operationType}),c.jsx(T,{control:n,name:"observations",label:"Observaciones",errorMessage:((L=t.observations)==null?void 0:L.message)||"",error:!!t.observations}),c.jsx(F.Button,{type:"submit",className:"mt-10",children:x})]})};export{ie as default};
