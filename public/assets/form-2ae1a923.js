import{v as O,w as h,y as E,n as N,r as u,d as $,ad as L,t as p,p as q,Q as S,a as I,f as V,j as r,L as C,c as j,o as M}from"./index-147be8e0.js";import{S as k}from"./select-827e997f.js";import{T as w}from"./text-area-b923794a.js";import{D as Q}from"./date-picker-bff55210.js";import{a as T}from"./observation-9649c52f.js";import{Y}from"./validations-7acdea7d.js";import{u as v}from"./employee-75ad9128.js";import"./useQuery-2739f2d7.js";const F=O().shape({employeeId:Y.required("El empleado es requerido!"),observation:h().required("La observacion es requerida!"),date:O().shape({startDate:h().required(),endDate:h().required()}).required("Las fechas son requieridas")}),R={observation:"",date:{startDate:"",endDate:""}};function A(){const i=E(),f=N(),{observation:e,isLoading:y}=T(),b=u.useMemo(()=>{var a,t,s,l,m;return{observation:(e==null?void 0:e.observation)||"",date:{startDate:(e==null?void 0:e.initDate)||"",endDate:(e==null?void 0:e.endDate)||"",selection:"selection"},employeeId:{id:((a=e==null?void 0:e.employee)==null?void 0:a.id)||"",value:((t=e==null?void 0:e.employee)==null?void 0:t.id)||"",label:`${(s=e==null?void 0:e.employee)==null?void 0:s.identification} - ${(l=e==null?void 0:e.employee)==null?void 0:l.name} ${(m=e==null?void 0:e.employee)==null?void 0:m.lastName}`}}},[e]),o=$(),n=u.useCallback(async a=>{var t;try{await L.editObservation(i.id||"",{...a,employeeId:(t=a==null?void 0:a.employeeId)==null?void 0:t.id,date:{endDate:a.date.endDate,startDate:a.date.startDate}}),o("/employee/observations"),p("Observacion actualizado exitosamente",null)}catch(s){p(`opps!! algo no va bien ${s.response.data.message||""}`,"error"),console.error(s)}},[i,o]),c=u.useCallback(async a=>{var t;try{const s=await L.createObservation({...a,employeeId:(t=a==null?void 0:a.employeeId)==null?void 0:t.id,date:{endDate:a.date.endDate,startDate:a.date.startDate}});return p("Observacion creada exitosamente",null),o("/employee/observations"),s}catch(s){p(`opps!! algo no va bien ${s.response.data.message||""}`,"error"),console.error(s)}},[o]),{mutateAsync:g,isLoading:x}=q(i.id?n:c,{onSuccess:()=>{f.invalidateQueries([S.OBSERVATION])}});return{isLoading:y||x,submit:g,formValues:{defaultValues:i.id?b:R},status:i.id?"Editar Observacion":"Crear Observacion",isEditing:!!i.id}}const J=()=>{var s,l,m,D;const{submit:i,isLoading:f,formValues:{defaultValues:e},status:y}=A(),{handleSubmit:b,reset:o,formState:{errors:n},control:c}=I({mode:"all",defaultValues:e,resolver:M(F)}),{pathname:g}=V();u.useEffect(()=>{o(e)},[o,e]);const x=d=>{i(d)},{employees:a,isLoading:t}=v();return f||t?r.jsx(C,{}):r.jsxs("form",{onSubmit:b(x),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[r.jsx("div",{className:"flex gap-4",children:r.jsx(w,{control:c,name:"observation",label:"Observacion",errorMessage:((s=n.observation)==null?void 0:s.message)||"",error:!!n.observation})}),r.jsx("div",{className:"flex gap-4",children:!g.split("/").includes("info")&&r.jsx(k,{control:c,name:"employeeId",options:((l=a==null?void 0:a.results)==null?void 0:l.map(d=>({id:d.id,label:`${d.identification} - ${d.name} ${d.lastName}`,value:d.id})))||[],errorMessage:((D=(m=n.employeeId)==null?void 0:m.label)==null?void 0:D.message)||"",placeholder:"Empleado"})}),r.jsxs("div",{className:"w-full",children:[r.jsx(j.Typography,{variant:"h4",className:`${n.date?"text-red-300":""}`,children:"Fechas de inicio y salida"}),r.jsx(Q,{control:c,name:"date",errorMessage:n.date?"las fechas de inico y salida son requieridas":""})]}),r.jsx(j.Button,{type:"submit",className:"mt-10",children:y})]})};export{J as default};
