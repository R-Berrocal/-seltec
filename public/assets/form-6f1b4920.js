import{r as l,j as n,a3 as E,a5 as O,a6 as L,a as y,n as w,o as g,q as N,k as S,b as k,m as h,l as q,s as $,e as C,t as I}from"./index-5c19e2b0.js";import{S as V}from"./select-261fe60b.js";import{T as M}from"./text-area-57b4863e.js";import{Q as z}from"./query-keys-c2ebbff1.js";import{b as R,O as v}from"./observation-29a8f247.js";import{Y as F}from"./validations-ded1d560.js";import{a as Q}from"./employee-1ed3515a.js";function j(){const{innerWidth:t,innerHeight:r}=window;return{width:t,height:r}}function T(){const[t,r]=l.useState(j());return l.useEffect(()=>{function e(){r(j())}return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),t}const W=({control:t,name:r="",errorMessage:e,...u})=>{const[p,d]=l.useState([{startDate:new Date,endDate:new Date,key:"selection"}]),{width:i}=T();return n.jsxs("div",{className:"flex flex-col w-full",children:[n.jsx(E,{render:({field:o})=>{const c=Object.values(o.value)[0].length!==0?[{startDate:new Date(o.value.startDate),endDate:new Date(o.value.endDate),key:"selection"}]:p;return l.createElement(O.DateRangePicker,{...u,key:r,editableDateInputs:!0,locale:L.es,onChange:a=>{d([{endDate:a.selection.endDate||new Date,startDate:a.selection.startDate||new Date,key:"selection"}]),o.onChange(a.selection)},moveRangeOnFirstSelection:!1,months:i<=750?1:2,ranges:c,direction:"horizontal",className:"w-full h-full",color:"#000"})},control:t,name:r}),n.jsx(y.Typography,{className:"text-red-400 text-xs italic",children:e})]})},Y=w().shape({employeeId:F.required("El empleado es requerido!"),observation:g().required("La observacion es requerida!"),date:w().shape({startDate:g().required(),endDate:g().required()}).required("Las fechas son requieridas")}),H={observation:"",date:{startDate:"",endDate:""}};function P(){const t=N(),r=S(),{observation:e,isLoading:u}=R(),p=l.useMemo(()=>{var a,s,D;return{observation:(e==null?void 0:e.observation)||"",date:{startDate:(e==null?void 0:e.initDate)||"",endDate:(e==null?void 0:e.endDate)||"",selection:"selection"},employeeId:{id:(e==null?void 0:e.employee.id)||"",value:(e==null?void 0:e.employee.id)||"",label:`${(a=e==null?void 0:e.employee)==null?void 0:a.identification} - ${(s=e==null?void 0:e.employee)==null?void 0:s.name} ${(D=e==null?void 0:e.employee)==null?void 0:D.lastName}`}}},[e]),d=k(),i=l.useCallback(async a=>{try{await v.editObservation(t.id||"",{...a,employeeId:a.employeeId.id,date:{endDate:a.date.endDate,startDate:a.date.startDate}}),h("Observacion actualizado exitosamente",null)}catch(s){h(`opps!! algo no va bien ${s.response.data.message||""}`,"error"),console.error(s)}},[t]),o=l.useCallback(async a=>{try{const s=await v.createObservation({...a,employeeId:a.employeeId.id,date:{endDate:a.date.endDate,startDate:a.date.startDate}});return h("Observacion creada exitosamente",null),d("/employee/observations"),s}catch(s){h(`opps!! algo no va bien ${s.response.data.message||""}`,"error"),console.error(s)}},[d]),{mutateAsync:f,isLoading:c}=q(t.id?i:o,{onSuccess:()=>{r.invalidateQueries([z.VEHICLE])}});return{isLoading:u||c,submit:f,formValues:{defaultValues:t.id?p:H},status:t.id?"Editar Observacion":"Crear Observacion",isEditing:!!t.id}}const X=()=>{var s,D,x,b;const{submit:t,isLoading:r,formValues:{defaultValues:e},status:u}=P(),{handleSubmit:p,reset:d,formState:{errors:i},control:o}=$({mode:"all",defaultValues:e,resolver:I(Y)});l.useEffect(()=>{d(e)},[d,e]);const f=m=>{t(m)},{employees:c,isLoading:a}=Q();return r||a?n.jsx(C,{}):n.jsxs("form",{onSubmit:p(f),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[n.jsx("div",{className:"flex gap-4",children:n.jsx(M,{control:o,name:"observation",label:"Observacion",errorMessage:((s=i.observation)==null?void 0:s.message)||"",error:!!i.observation})}),n.jsx("div",{className:"flex gap-4",children:n.jsx(V,{control:o,name:"employeeId",options:((D=c==null?void 0:c.results)==null?void 0:D.map(m=>({id:m.id,label:`${m.identification} - ${m.name} ${m.lastName}`,value:m.id})))||[],errorMessage:((b=(x=i.employeeId)==null?void 0:x.label)==null?void 0:b.message)||"",placeholder:"Empleado"})}),n.jsxs("div",{className:"w-full",children:[n.jsx(y.Typography,{variant:"h4",className:`${i.date?"text-red-300":""}`,children:"Fechas de inicio y salida"}),n.jsx(W,{control:o,name:"date",errorMessage:i.date?"las fechas de inico y salida son requieridas":""})]}),n.jsx(y.Button,{type:"submit",className:"mt-10",children:u})]})};export{X as default};
