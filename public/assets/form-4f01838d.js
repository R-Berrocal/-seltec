import{B as S,D as w,F as C,k as N,u as P,r as f,b as k,m as g,l as q,G as D,j as r,e as I,I as d,a as Q,H as $}from"./index-38497bf7.js";import{S as A}from"./select-4c88e899.js";import{Q as F}from"./query-keys-cd3f1922.js";import{b as H,V as L}from"./vehicle-a422c52d.js";import{a as O}from"./company-b53ca5b4.js";const Y=S().shape({plate:w().required("La placa es requerida!")}),v={plate:"",type:"",model:"",trailerPlate:"",owner:"",company:""};function B(){const t=C(),b=N(),{vehicle:e,isLoading:i}=H(),{user:n}=P(),p=f.useMemo(()=>{var l,s;return{plate:(e==null?void 0:e.plate)||"",type:(e==null?void 0:e.type)||"",model:(e==null?void 0:e.model)||"",trailerPlate:(e==null?void 0:e.trailerPlate)||"",owner:(e==null?void 0:e.owner)||"",company:(n==null?void 0:n.role)==="COMPANY"?(l=n.company)==null?void 0:l.id:((s=e==null?void 0:e.company)==null?void 0:s.id)||""}},[e,n]),c=k(),a=f.useCallback(async l=>{try{await L.editVehicle(t.id||"",l),g("Vehiculo actualizado exitosamente",null)}catch(s){g(`opps!! algo no va bien ${s.response.data.message||""}`,"error"),console.error(s)}},[t]),o=f.useCallback(async l=>{try{const s=await L.createVehicle(l);return g("Vehiculo creado exitosamente",null),c("/vehicles"),s}catch(s){g(`opps!! algo no va bien ${s.response.data.message||""}`,"error"),console.error(s)}},[c]),{mutateAsync:x,isLoading:m}=q(t.id?a:o,{onSuccess:()=>{b.invalidateQueries([F.VEHICLE])}});return{isLoading:i||m,submit:x,formValues:{defaultValues:Object.keys(p).length<0?v:p},status:t.id?"Editar vehiculo":"Crear vehiculo",isEditing:!!t.id}}const U=()=>{var s,y,V,h,j,M,E;const{user:t}=P(),{submit:b,isLoading:e,formValues:{defaultValues:i},status:n}=B(),{handleSubmit:p,reset:c,formState:{errors:a},control:o}=D({mode:"all",defaultValues:i,resolver:$(Y)});f.useEffect(()=>{c(i)},[c,i]);const x=u=>{b(u)},{companies:m,isLoading:l}=O();return e||l?r.jsx(I,{}):r.jsxs("form",{onSubmit:p(x),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[r.jsxs("div",{className:"flex gap-4",children:[r.jsx(d,{control:o,name:"plate",label:"Placa",errorMessage:((s=a.plate)==null?void 0:s.message)||"",error:!!a.plate}),r.jsx(d,{control:o,name:"type",label:"Tipo",errorMessage:((y=a.type)==null?void 0:y.message)||"",error:!!a.type})]}),r.jsxs("div",{className:"flex gap-4",children:[r.jsx(d,{control:o,name:"model",label:"Modelo",errorMessage:((V=a.model)==null?void 0:V.message)||"",error:!!a.model}),r.jsx(d,{control:o,name:"trailerPlate",label:"Placa de remolque",errorMessage:((h=a.trailerPlate)==null?void 0:h.message)||"",error:!!a.trailerPlate})]}),r.jsxs("div",{className:"flex gap-4",children:[r.jsx(d,{control:o,name:"owner",label:"DueÃ±o",errorMessage:((j=a.owner)==null?void 0:j.message)||"",error:!!a.owner}),(t==null?void 0:t.role)==="ADMIN"&&r.jsx(A,{children:!0,label:"Empresa",control:o,name:"company",options:((M=m==null?void 0:m.results)==null?void 0:M.map(u=>({id:u.id,label:u.name,value:u.id})))||[],errorMessage:((E=a.company)==null?void 0:E.message)||"",placeholder:"Empresa"})]}),r.jsx(Q.Button,{type:"submit",className:"mt-10",children:n})]})};export{U as default};
