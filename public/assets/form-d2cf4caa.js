import{n as E,o as S,q as w,k as A,u as h,r as b,b as k,m as x,l as q,s as Y,j as t,e as $,I as f,a as I,t as O}from"./index-a20a86ba.js";import{S as Q}from"./select-453db961.js";import{Q as D}from"./query-keys-94b21177.js";import{a as z,V as N}from"./vehicle-758a2329.js";import{a as F}from"./company-3e46ec56.js";const H=E().shape({plate:S().required("La placa es requerida!").max(6,"solo pueden ser 6 digitos").matches(/^[aA-zZ0-9]{6}$/,{message:"placa no valida"})}),R={plate:"",type:"",model:"",trailerPlate:"",owner:""};function B(){const m=w(),V=A(),{vehicle:e,isLoading:d}=z(),{user:a}=h(),j=b.useMemo(()=>{var s,n,l,o,g,y;return{plate:(e==null?void 0:e.plate)||"",type:(e==null?void 0:e.type)||"",model:(e==null?void 0:e.model)||"",trailerPlate:(e==null?void 0:e.trailerPlate)||"",owner:(e==null?void 0:e.owner)||"",company:(a==null?void 0:a.role)==="COMPANY"?{label:((s=a.company)==null?void 0:s.id)||"",value:((n=a.company)==null?void 0:n.id)||"",id:((l=a.company)==null?void 0:l.id)||""}:{id:((o=e==null?void 0:e.company)==null?void 0:o.id)||"",label:((g=e==null?void 0:e.company)==null?void 0:g.name)||"",value:((y=e==null?void 0:e.company)==null?void 0:y.id)||""}}},[e,a]),p=k(),r=b.useCallback(async s=>{var n,l;try{await N.editVehicle(m.id||"",{...s,company:(a==null?void 0:a.role)==="COMPANY"?((n=a.company)==null?void 0:n.id)||"":(l=s==null?void 0:s.company)==null?void 0:l.value}),x("Vehiculo actualizado exitosamente",null)}catch(o){x(`opps!! algo no va bien ${o.response.data.message||""}`,"error"),console.error(o)}},[m,a]),c=b.useCallback(async s=>{var n,l;try{const o=await N.createVehicle({...s,company:(a==null?void 0:a.role)==="COMPANY"?((n=a.company)==null?void 0:n.id)||"":(l=s==null?void 0:s.company)==null?void 0:l.value});return x("Vehiculo creado exitosamente",null),p("/vehicles"),o}catch(o){x(`opps!! algo no va bien ${o.response.data.message||""}`,"error"),console.error(o)}},[p,a]),{mutateAsync:M,isLoading:u}=q(m.id?r:c,{onSuccess:()=>{V.invalidateQueries([D.VEHICLE])}});return{isLoading:d||u,submit:M,formValues:{defaultValues:m.id?j:R},status:m.id?"Editar vehiculo":"Crear vehiculo",isEditing:!!m.id}}const _=()=>{var n,l,o,g,y,P,C,L;const{user:m}=h(),{submit:V,isLoading:e,formValues:{defaultValues:d},status:a}=B(),{handleSubmit:j,reset:p,formState:{errors:r},control:c}=Y({mode:"all",defaultValues:d,resolver:O(H)});b.useEffect(()=>{p(d)},[p,d]);const M=i=>{V(i)},{companies:u,isLoading:s}=F();return e||s?t.jsx($,{}):t.jsxs("form",{onSubmit:j(M),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[t.jsxs("div",{className:"flex gap-4",children:[t.jsx(f,{control:c,name:"plate",label:"Placa",errorMessage:((n=r.plate)==null?void 0:n.message)||"",error:!!r.plate}),t.jsx(f,{control:c,name:"type",label:"Tipo",errorMessage:((l=r.type)==null?void 0:l.message)||"",error:!!r.type})]}),t.jsxs("div",{className:"flex gap-4",children:[t.jsx(f,{control:c,name:"model",label:"Modelo",errorMessage:((o=r.model)==null?void 0:o.message)||"",error:!!r.model}),t.jsx(f,{control:c,name:"trailerPlate",label:"Placa de remolque",errorMessage:((g=r.trailerPlate)==null?void 0:g.message)||"",error:!!r.trailerPlate})]}),t.jsx("div",{className:"flex gap-4",children:t.jsx(f,{control:c,name:"owner",label:"DueÃ±o",errorMessage:((y=r.owner)==null?void 0:y.message)||"",error:!!r.owner})}),(m==null?void 0:m.role)==="ADMIN"&&t.jsx(Q,{control:c,name:"company",options:((P=u==null?void 0:u.results)==null?void 0:P.map(i=>({id:i==null?void 0:i.id,label:i==null?void 0:i.name,value:i==null?void 0:i.id})))||[],errorMessage:((L=(C=r.company)==null?void 0:C.label)==null?void 0:L.message)||"",placeholder:"Empresa"}),t.jsx(I.Button,{type:"submit",className:"mt-10",children:a})]})};export{_ as default};
