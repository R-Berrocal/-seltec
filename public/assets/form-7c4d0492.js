import{n as w,o as C,q as N,k,u as S,r as x,b as q,m as b,l as $,s as A,j as r,e as I,I as f,a as Q,t as D}from"./index-3bd54e17.js";import{S as Y}from"./select-ac1060be.js";import{Q as z}from"./query-keys-f3f28151.js";import{b as F,V as E}from"./vehicle-2cda006d.js";import{a as H}from"./company-8fb3857a.js";const O=w().shape({plate:C().required("La placa es requerida!").max(6,"solo pueden ser 6 digitos").matches(/^[aA-zZ0-9]{6}$/,{message:"placa no valida"})}),R={plate:"",type:"",model:"",trailerPlate:"",owner:""};function B(){const n=N(),V=k(),{vehicle:e,isLoading:c}=F(),{user:i}=S(),j=x.useMemo(()=>{var l,o,s,p,g,y;return{plate:(e==null?void 0:e.plate)||"",type:(e==null?void 0:e.type)||"",model:(e==null?void 0:e.model)||"",trailerPlate:(e==null?void 0:e.trailerPlate)||"",owner:(e==null?void 0:e.owner)||"",company:(i==null?void 0:i.role)==="COMPANY"?{label:((l=i.company)==null?void 0:l.id)||"",value:((o=i.company)==null?void 0:o.id)||"",id:((s=i.company)==null?void 0:s.id)||""}:{id:((p=e==null?void 0:e.company)==null?void 0:p.id)||"",label:((g=e==null?void 0:e.company)==null?void 0:g.name)||"",value:((y=e==null?void 0:e.company)==null?void 0:y.id)||""}}},[e,i]),u=q(),a=x.useCallback(async l=>{var o;try{await E.editVehicle(n.id||"",{...l,company:(o=l.company)==null?void 0:o.id}),b("Vehiculo actualizado exitosamente",null)}catch(s){b(`opps!! algo no va bien ${s.response.data.message||""}`,"error"),console.error(s)}},[n]),m=x.useCallback(async l=>{var o;try{const s=await E.createVehicle({...l,company:(o=l.company)==null?void 0:o.id});return b("Vehiculo creado exitosamente",null),u("/vehicles"),s}catch(s){b(`opps!! algo no va bien ${s.response.data.message||""}`,"error"),console.error(s)}},[u]),{mutateAsync:M,isLoading:d}=$(n.id?a:m,{onSuccess:()=>{V.invalidateQueries([z.VEHICLE])}});return{isLoading:c||d,submit:M,formValues:{defaultValues:n.id?j:R},status:n.id?"Editar vehiculo":"Crear vehiculo",isEditing:!!n.id}}const _=()=>{var o,s,p,g,y,L,P,h;const{user:n}=S(),{submit:V,isLoading:e,formValues:{defaultValues:c},status:i}=B(),{handleSubmit:j,reset:u,formState:{errors:a},control:m}=A({mode:"all",defaultValues:c,resolver:D(O)});x.useEffect(()=>{u(c)},[u,c]);const M=t=>{V(t)},{companies:d,isLoading:l}=H();return e||l?r.jsx(I,{}):r.jsxs("form",{onSubmit:j(M),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[r.jsxs("div",{className:"flex gap-4",children:[r.jsx(f,{control:m,name:"plate",label:"Placa",errorMessage:((o=a.plate)==null?void 0:o.message)||"",error:!!a.plate}),r.jsx(f,{control:m,name:"type",label:"Tipo",errorMessage:((s=a.type)==null?void 0:s.message)||"",error:!!a.type})]}),r.jsxs("div",{className:"flex gap-4",children:[r.jsx(f,{control:m,name:"model",label:"Modelo",errorMessage:((p=a.model)==null?void 0:p.message)||"",error:!!a.model}),r.jsx(f,{control:m,name:"trailerPlate",label:"Placa de remolque",errorMessage:((g=a.trailerPlate)==null?void 0:g.message)||"",error:!!a.trailerPlate})]}),r.jsx("div",{className:"flex gap-4",children:r.jsx(f,{control:m,name:"owner",label:"DueÃ±o",errorMessage:((y=a.owner)==null?void 0:y.message)||"",error:!!a.owner})}),(n==null?void 0:n.role)==="ADMIN"&&r.jsx(Y,{control:m,name:"company",options:((L=d==null?void 0:d.results)==null?void 0:L.map(t=>({id:t==null?void 0:t.id,label:t==null?void 0:t.name,value:t==null?void 0:t.id})))||[],errorMessage:((h=(P=a.company)==null?void 0:P.label)==null?void 0:h.message)||"",placeholder:"Empresa"}),r.jsx(Q.Button,{type:"submit",className:"mt-10",children:i})]})};export{_ as default};
