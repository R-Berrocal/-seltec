import{t as B,v as N,w as H,x as K,n as U,c as w,r as y,q as h,p as _,Q as z,a as J,d as T,j as i,L as W,I as j,b as X,o as Z}from"./index-d0930347.js";import{S as A}from"./select-f7f42a5f.js";import{a as v,E as F}from"./employee-66af281a.js";import{Y as G}from"./validations-11ac4e3d.js";import{a as ee}from"./company-efc6b59d.js";import{u as re}from"./group-c99f38ae.js";import{u as se}from"./role-2dd2f2d4.js";import{A as oe}from"./alert-f35b79f8.js";import"./useQuery-90db40b4.js";const ie=B().shape({name:N().required("El nombre es requerido!"),lastName:N().required("El apellido es requerido!"),email:N().required("El correo electronico es requerido!"),identification:N().required("La identificacion es requerida!").matches(/^\d+$/,"Solo deben ser numeros"),role:G.required("El rol es requerido!"),groups:H().of(G.required("Los grupos son requeridos!")).required("Los grupos son requeridos!")}),ae={name:"",lastName:"",email:"",identification:"",groups:[]};function te(){const c=K(),q=U(),{employee:e,isLoading:f}=v(),{user:o,showAlert:M}=w(),x=y.useMemo(()=>{var s,p,m,u,a,n,g,E,L,b;return{name:(e==null?void 0:e.name)||"",lastName:(e==null?void 0:e.lastName)||"",email:(e==null?void 0:e.email)||"",identification:(e==null?void 0:e.identification)||"",role:{value:((s=e==null?void 0:e.roleEmployee)==null?void 0:s.id)||"",label:((p=e==null?void 0:e.roleEmployee)==null?void 0:p.name)||"",id:((m=e==null?void 0:e.roleEmployee)==null?void 0:m.id)||""},company:(o==null?void 0:o.role)==="COMPANY"?{label:((u=o.company)==null?void 0:u.id)||"",value:((a=o.company)==null?void 0:a.id)||"",id:((n=o.company)==null?void 0:n.id)||""}:{id:((g=e==null?void 0:e.company)==null?void 0:g.id)||"",label:((E=e==null?void 0:e.company)==null?void 0:E.name)||"",value:((L=e==null?void 0:e.company)==null?void 0:L.id)||""},groups:((b=e==null?void 0:e.groups)==null?void 0:b.map(d=>({label:(d==null?void 0:d.name)||"",id:(d==null?void 0:d.id)||"",value:(d==null?void 0:d.id)||""})))||[]}},[e,o]),t=y.useCallback(async s=>{var p,m,u,a;try{await F.editEmployee(c.id||"",{...s,groups:(p=s==null?void 0:s.groups)==null?void 0:p.map(n=>n==null?void 0:n.id),role:(m=s==null?void 0:s.role)==null?void 0:m.value,company:(o==null?void 0:o.role)==="COMPANY"?((u=o.company)==null?void 0:u.id)||"":(a=s==null?void 0:s.company)==null?void 0:a.value}),h("Empleado editado de forma correcta",null)}catch(n){h(`opps!! algo no va bien ${n.response.data.message||""}`,"error"),console.error(n)}},[c,o]),l=y.useCallback(async s=>{var p,m,u;try{const a=await F.createEmployee({...s,groups:s.groups.map(n=>n.id),role:(p=s==null?void 0:s.role)==null?void 0:p.value,company:(o==null?void 0:o.role)==="COMPANY"?((m=o.company)==null?void 0:m.id)||"":(u=s==null?void 0:s.company)==null?void 0:u.value});return h("Empleado creado",null),a}catch(a){h(`opps!! algo no va bien ${a.response.data.message||""}`,"error"),console.error(a)}},[o]),{mutateAsync:C,isLoading:S}=_(c.id?t:l,{onSuccess:s=>{q.invalidateQueries([z.EMPLOYEE]),M(s.id)}});return{isLoading:f||S,submit:C,formValues:{defaultValues:c.id?x:ae},status:c.id?"Editar empleado":"Crear empleado",isEditing:!!c.id}}const be=()=>{var b,d,Y,$,O,P,V,D,k,I,Q,R;const{user:c}=w(),{submit:q,isLoading:e,formValues:{defaultValues:f},status:o}=te(),{handleSubmit:M,reset:x,formState:{errors:t},control:l}=J({mode:"all",defaultValues:f,resolver:Z(ie)}),{id:C,closeAlert:S,showDrawer:s}=w(),p=T(),{companies:m,isLoading:u}=ee(),{groups:a,isLoading:n}=re(),{roles:g,isLoading:E}=se();y.useEffect(()=>{x(f)},[x,f]);const L=r=>{q(r)};return e||u||n||E?i.jsx(W,{}):i.jsxs(i.Fragment,{children:[i.jsxs("form",{onSubmit:M(L),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[i.jsxs("div",{className:"flex gap-4",children:[i.jsx(j,{control:l,name:"name",label:"Nombre",errorMessage:((b=t.name)==null?void 0:b.message)||"",error:!!t.name}),i.jsx(j,{control:l,name:"lastName",label:"Apellido",errorMessage:((d=t.lastName)==null?void 0:d.message)||"",error:!!t.lastName})]}),i.jsxs("div",{className:"flex gap-4",children:[i.jsx(j,{control:l,name:"email",label:"Correo electronico",type:"email",errorMessage:((Y=t.email)==null?void 0:Y.message)||"",error:!!t.email}),i.jsx(j,{control:l,type:"number",name:"identification",label:"Identificacion",errorMessage:(($=t.identification)==null?void 0:$.message)||"",error:!!t.identification})]}),(c==null?void 0:c.role)==="ADMIN"&&i.jsx("div",{className:"flex gap-4",children:i.jsx(A,{control:l,name:"company",options:((O=m==null?void 0:m.results)==null?void 0:O.map(r=>({id:r==null?void 0:r.id,label:r==null?void 0:r.name,value:r==null?void 0:r.id})))||[],placeholder:"Empresa",errorMessage:((V=(P=t.company)==null?void 0:P.label)==null?void 0:V.message)||""})}),i.jsxs("div",{className:"flex gap-4",children:[i.jsx(A,{control:l,name:"groups",isMulti:!0,options:((D=a==null?void 0:a.results)==null?void 0:D.map(r=>({id:r==null?void 0:r.id,label:r==null?void 0:r.name,value:r==null?void 0:r.id})))||[],placeholder:"Bloque",errorMessage:((k=t.groups)==null?void 0:k.message)||""}),i.jsx(A,{control:l,name:"role",options:((I=g==null?void 0:g.results)==null?void 0:I.map(r=>({id:r==null?void 0:r.id,label:r==null?void 0:r.name,value:r==null?void 0:r.id})))||[],placeholder:"Cargo",errorMessage:((R=(Q=t.role)==null?void 0:Q.label)==null?void 0:R.message)||""})]}),i.jsx(X.Button,{type:"submit",className:"mt-10",children:o})]}),i.jsx(oe,{acction:()=>{p(`/employee/employees/info/${C}`),S(),s()},title:"Desea agregar una observacion al empleado creado?",description:"Dele 'confirmar' si es asi, en caso contrario dele cancelar."})]})};export{be as default};
