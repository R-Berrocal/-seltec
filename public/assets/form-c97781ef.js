import{n as N,o as j,y as k,q as $,k as Q,r as p,b as Y,m as d,l as w,s as D,j as t,e as I,I as O,a as F,t as G}from"./index-bbfb2b48.js";import{S as T}from"./select-3349b55e.js";import{T as A}from"./text-area-392e14e3.js";import{Q as R}from"./query-keys-f38cae6f.js";import{b as z,A as M}from"./assigned-vehicle-7a9a7c0d.js";import{Y as C}from"./validations-8443da6f.js";import{a as B}from"./vehicle-1df044db.js";import{a as H}from"./employee-f8758d6c.js";const K=N().shape({operationType:j().required("El tipo de operacion es requerido!"),daysService:k().min(1,"debe ser mayor o igual que 1").required("los dias de servicios son requeridos!"),observations:j().required("La observacion es requerida!"),vehicle:C.required("El vehiculo es requerido!"),employee:C.required("El empleado es requerido!")}),P={operationType:"",daysService:0,observations:""};function U(){const l=$(),y=Q(),{assigned:e,isLoading:b}=z(),v=p.useMemo(()=>({daysService:(e==null?void 0:e.daysService)||0,observations:(e==null?void 0:e.observations)||"",operationType:(e==null?void 0:e.operationType)||"",employee:{id:(e==null?void 0:e.employee.id)||"",value:(e==null?void 0:e.employee.id)||"",label:(e==null?void 0:e.employee.identification)||""},vehicle:{id:(e==null?void 0:e.vehicle.id)||"",value:(e==null?void 0:e.vehicle.id)||"",label:(e==null?void 0:e.vehicle.plate)||""}}),[e]),m=Y(),s=p.useCallback(async a=>{var r,n;try{await M.editAssignedVehicle(l.id||"",{...a,vehicle:(r=a.vehicle)==null?void 0:r.id,employee:(n=a.employee)==null?void 0:n.id}),d("Vehiculo actualizado exitosamente",null)}catch(o){d(`opps!! algo no va bien ${o.response.data.message||""}`,"error"),console.error(o)}},[l]),c=p.useCallback(async a=>{var r,n;try{const o=await M.createAssignedVehicle({...a,vehicle:(r=a.vehicle)==null?void 0:r.id,employee:(n=a.employee)==null?void 0:n.id});return d("Vehiculo creado exitosamente",null),m("/employee/assigned"),o}catch(o){d(`opps!! algo no va bien ${o.response.data.message||""}`,"error"),console.error(o)}},[m]),{mutateAsync:h,isLoading:u}=w(l.id?s:c,{onSuccess:()=>{y.invalidateQueries([R.ASSIGNED])}});return{isLoading:b||u,submit:h,formValues:{defaultValues:l.id?v:P},status:l.id?"Editar assignacion":"Crear assignacion",isEditing:!!l.id}}const ae=()=>{var o,f,g,x,S,V,E,q,L;const{submit:l,isLoading:y,formValues:{defaultValues:e},status:b}=U(),{handleSubmit:v,reset:m,formState:{errors:s},control:c}=D({mode:"all",defaultValues:e,resolver:G(K)});p.useEffect(()=>{m(e)},[m,e]);const h=i=>{l(i)},{vehicles:u,isLoading:a}=B(),{employees:r,isLoading:n}=H();return y||a||n?t.jsx(I,{}):t.jsxs("form",{onSubmit:v(h),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[t.jsx(O,{control:c,name:"daysService",label:"Dias de servicio",type:"number",errorMessage:((o=s.daysService)==null?void 0:o.message)||"",error:!!s.daysService}),t.jsxs("div",{className:"flex gap-4",children:[t.jsx(T,{control:c,name:"vehicle",options:((f=u==null?void 0:u.results)==null?void 0:f.map(i=>({id:i.id,label:i.plate,value:i.id})))||[],errorMessage:((x=(g=s.vehicle)==null?void 0:g.label)==null?void 0:x.message)||"",placeholder:"Vehiculo"}),t.jsx(T,{control:c,name:"employee",options:((S=r==null?void 0:r.results)==null?void 0:S.map(i=>({id:i.id,label:i.identification,value:i.id})))||[],errorMessage:((E=(V=s.employee)==null?void 0:V.label)==null?void 0:E.message)||"",placeholder:"Empleado"})]}),t.jsx(A,{control:c,name:"operationType",label:"Tipo de operacion",errorMessage:((q=s.operationType)==null?void 0:q.message)||"",error:!!s.operationType}),t.jsx(A,{control:c,name:"observations",label:"Observaciones",errorMessage:((L=s.observations)==null?void 0:L.message)||"",error:!!s.observations}),t.jsx(F.Button,{type:"submit",className:"mt-10",children:b})]})};export{ae as default};
