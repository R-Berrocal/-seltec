import{n as w,o as C,q as N,k,u as S,r as y,b as q,m as g,l as $,s as A,j as r,e as I,I as p,a as Q,t as D}from"./index-bbfb2b48.js";import{S as Y}from"./select-3349b55e.js";import{Q as z}from"./query-keys-f38cae6f.js";import{b as F,V as E}from"./vehicle-1df044db.js";import{a as H}from"./company-19698cd9.js";const O=w().shape({plate:C().required("La placa es requerida!").max(6,"solo pueden ser 6 digitos").matches(/^[aA-zZ0-9]{6}$/,{message:"placa no valida"})}),R={plate:"",type:"",model:"",trailerPlate:"",owner:""};function B(){const t=N(),f=k(),{vehicle:e,isLoading:m}=F(),{user:n}=S(),b=y.useMemo(()=>{var l,o,s;return{plate:(e==null?void 0:e.plate)||"",type:(e==null?void 0:e.type)||"",model:(e==null?void 0:e.model)||"",trailerPlate:(e==null?void 0:e.trailerPlate)||"",owner:(e==null?void 0:e.owner)||"",company:(n==null?void 0:n.role)==="COMPANY"?{label:((l=n.company)==null?void 0:l.id)||"",value:((o=n.company)==null?void 0:o.id)||"",id:((s=n.company)==null?void 0:s.id)||""}:{id:(e==null?void 0:e.company.id)||"",label:(e==null?void 0:e.company.name)||"",value:(e==null?void 0:e.company.id)||""}}},[e,n]),c=q(),a=y.useCallback(async l=>{var o;try{await E.editVehicle(t.id||"",{...l,company:(o=l.company)==null?void 0:o.id}),g("Vehiculo actualizado exitosamente",null)}catch(s){g(`opps!! algo no va bien ${s.response.data.message||""}`,"error"),console.error(s)}},[t]),i=y.useCallback(async l=>{var o;try{const s=await E.createVehicle({...l,company:(o=l.company)==null?void 0:o.id});return g("Vehiculo creado exitosamente",null),c("/vehicles"),s}catch(s){g(`opps!! algo no va bien ${s.response.data.message||""}`,"error"),console.error(s)}},[c]),{mutateAsync:x,isLoading:u}=$(t.id?a:i,{onSuccess:()=>{f.invalidateQueries([z.VEHICLE])}});return{isLoading:m||u,submit:x,formValues:{defaultValues:t.id?b:R},status:t.id?"Editar vehiculo":"Crear vehiculo",isEditing:!!t.id}}const _=()=>{var o,s,V,j,M,L,P,h;const{user:t}=S(),{submit:f,isLoading:e,formValues:{defaultValues:m},status:n}=B(),{handleSubmit:b,reset:c,formState:{errors:a},control:i}=A({mode:"all",defaultValues:m,resolver:D(O)});y.useEffect(()=>{c(m)},[c,m]);const x=d=>{f(d)},{companies:u,isLoading:l}=H();return e||l?r.jsx(I,{}):r.jsxs("form",{onSubmit:b(x),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[r.jsxs("div",{className:"flex gap-4",children:[r.jsx(p,{control:i,name:"plate",label:"Placa",errorMessage:((o=a.plate)==null?void 0:o.message)||"",error:!!a.plate}),r.jsx(p,{control:i,name:"type",label:"Tipo",errorMessage:((s=a.type)==null?void 0:s.message)||"",error:!!a.type})]}),r.jsxs("div",{className:"flex gap-4",children:[r.jsx(p,{control:i,name:"model",label:"Modelo",errorMessage:((V=a.model)==null?void 0:V.message)||"",error:!!a.model}),r.jsx(p,{control:i,name:"trailerPlate",label:"Placa de remolque",errorMessage:((j=a.trailerPlate)==null?void 0:j.message)||"",error:!!a.trailerPlate})]}),r.jsx("div",{className:"flex gap-4",children:r.jsx(p,{control:i,name:"owner",label:"DueÃ±o",errorMessage:((M=a.owner)==null?void 0:M.message)||"",error:!!a.owner})}),(t==null?void 0:t.role)==="ADMIN"&&r.jsx(Y,{control:i,name:"company",options:((L=u==null?void 0:u.results)==null?void 0:L.map(d=>({id:d.id,label:d.name,value:d.id})))||[],errorMessage:((h=(P=a.company)==null?void 0:P.label)==null?void 0:h.message)||"",placeholder:"Empresa"}),r.jsx(Q.Button,{type:"submit",className:"mt-10",children:n})]})};export{_ as default};
