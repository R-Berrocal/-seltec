import{n as P,o as N,p as Q,q as D,k as F,u as O,r as h,b as B,m as j,l as H,s as K,j as o,e as U,I as y,a as _,t as z}from"./index-5c19e2b0.js";import{S as V}from"./select-261fe60b.js";import{Q as J}from"./query-keys-c2ebbff1.js";import{b as T,E as I}from"./employee-1ed3515a.js";import{Y}from"./validations-ded1d560.js";import{a as W}from"./company-3360875d.js";import{u as X}from"./group-1ac14ef1.js";import{u as Z}from"./role-74efb446.js";const v=P().shape({name:N().required("El nombre es requerido!"),lastName:N().required("El apellido es requerido!"),email:N().required("El correo electronico es requerido!"),identification:N().required("La identificacion es requerida!"),role:Y.required("El rol es requerido!"),company:Y.required("La empresa es requerida!"),groups:Q().of(Y.required("Los grupos son requeridos!")).required("Los grupos son requeridos!")}),ee={name:"",lastName:"",email:"",identification:"",groups:[]};function re(){const d=D(),M=F(),{employee:e,isLoading:l}=T(),{user:u}=O(),S=h.useMemo(()=>{var s,c,t,n,a,b,E,x,L,q;return{name:(e==null?void 0:e.name)||"",lastName:(e==null?void 0:e.lastName)||"",email:(e==null?void 0:e.email)||"",identification:(e==null?void 0:e.identification)||"",role:{value:((s=e==null?void 0:e.roleEmployee)==null?void 0:s.id)||"",label:((c=e==null?void 0:e.roleEmployee)==null?void 0:c.name)||"",id:((t=e==null?void 0:e.roleEmployee)==null?void 0:t.id)||""},company:(u==null?void 0:u.role)==="COMPANY"?{label:((n=u.company)==null?void 0:n.id)||"",value:((a=u.company)==null?void 0:a.id)||"",id:((b=u.company)==null?void 0:b.id)||""}:{id:((E=e==null?void 0:e.company)==null?void 0:E.id)||"",label:((x=e==null?void 0:e.company)==null?void 0:x.name)||"",value:((L=e==null?void 0:e.company)==null?void 0:L.id)||""},groups:((q=e==null?void 0:e.groups)==null?void 0:q.map(m=>({label:(m==null?void 0:m.name)||"",id:(m==null?void 0:m.id)||"",value:(m==null?void 0:m.id)||""})))||[]}},[e,u]),g=B(),i=h.useCallback(async s=>{var c,t,n;try{await I.editEmployee(d.id||"",{...s,groups:(c=s==null?void 0:s.groups)==null?void 0:c.map(a=>a==null?void 0:a.id),role:(t=s==null?void 0:s.role)==null?void 0:t.value,company:(n=s==null?void 0:s.company)==null?void 0:n.value}),j("Empleado editado de forma correcta",null)}catch(a){j(`opps!! algo no va bien ${a.response.data.message||""}`,"error"),console.error(a)}},[d]),p=h.useCallback(async s=>{var c,t;try{const n=await I.createEmployee({...s,groups:s.groups.map(a=>a.id),role:(c=s==null?void 0:s.role)==null?void 0:c.value,company:(t=s==null?void 0:s.company)==null?void 0:t.value});return j("Empleado creado",null),g("/employee/employees"),n}catch(n){j(`opps!! algo no va bien ${n.response.data.message||""}`,"error"),console.error(n)}},[g]),{mutateAsync:f,isLoading:C}=H(d.id?i:p,{onSuccess:()=>{M.invalidateQueries([J.EMPLOYEE])}});return{isLoading:l||C,submit:f,formValues:{defaultValues:d.id?S:ee},status:d.id?"Editar empleado":"Crear empleado",isEditing:!!d.id}}const ce=()=>{var b,E,x,L,q,m,k,R,$,w,A,G;const{user:d}=O(),{submit:M,isLoading:e,formValues:{defaultValues:l},status:u}=re(),{handleSubmit:S,reset:g,formState:{errors:i},control:p}=K({mode:"all",defaultValues:l,resolver:z(v)}),{companies:f,isLoading:C}=W(),{groups:s,isLoading:c}=X(),{roles:t,isLoading:n}=Z();h.useEffect(()=>{g(l)},[g,l]);const a=r=>{M(r)};return e||C||c||n?o.jsx(U,{}):o.jsxs("form",{onSubmit:S(a),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[o.jsxs("div",{className:"flex gap-4",children:[o.jsx(y,{control:p,name:"name",label:"Nombre",errorMessage:((b=i.name)==null?void 0:b.message)||"",error:!!i.name}),o.jsx(y,{control:p,name:"lastName",label:"Apellido",errorMessage:((E=i.lastName)==null?void 0:E.message)||"",error:!!i.lastName})]}),o.jsxs("div",{className:"flex gap-4",children:[o.jsx(y,{control:p,name:"email",label:"Correo electronico",type:"email",errorMessage:((x=i.email)==null?void 0:x.message)||"",error:!!i.email}),o.jsx(y,{control:p,name:"identification",label:"Identificacion",errorMessage:((L=i.identification)==null?void 0:L.message)||"",error:!!i.identification})]}),o.jsx("div",{className:"flex gap-4",children:(d==null?void 0:d.role)==="ADMIN"&&o.jsx(V,{control:p,name:"company",options:((q=f==null?void 0:f.results)==null?void 0:q.map(r=>({id:r==null?void 0:r.id,label:r==null?void 0:r.name,value:r==null?void 0:r.id})))||[],placeholder:"Empresa",errorMessage:((k=(m=i.company)==null?void 0:m.label)==null?void 0:k.message)||""})}),o.jsxs("div",{className:"flex gap-4",children:[o.jsx(V,{control:p,name:"groups",isMulti:!0,options:((R=s==null?void 0:s.results)==null?void 0:R.map(r=>({id:r==null?void 0:r.id,label:r==null?void 0:r.name,value:r==null?void 0:r.id})))||[],placeholder:"Grupo",errorMessage:(($=i.groups)==null?void 0:$.message)||""}),o.jsx(V,{control:p,name:"role",options:((w=t==null?void 0:t.results)==null?void 0:w.map(r=>({id:r==null?void 0:r.id,label:r==null?void 0:r.name,value:r==null?void 0:r.id})))||[],placeholder:"Rol",errorMessage:((G=(A=i.role)==null?void 0:A.label)==null?void 0:G.message)||""})]}),o.jsx(_.Button,{type:"submit",className:"mt-10",children:u})]})};export{ce as default};
