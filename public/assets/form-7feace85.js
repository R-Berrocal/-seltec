import{t as C,v as $,A as k,x as Q,n as Y,r as f,d as w,q as h,p as D,Q as I,a as O,j as n,L as F,I as G,c as R,o as z}from"./index-d3a1a1dc.js";import{S as A}from"./select-212dbb9f.js";import{T}from"./text-area-f7a1ab95.js";import{a as B,A as M}from"./assigned-vehicle-b52a6be1.js";import{Y as N}from"./validations-6c4ba7d5.js";import{u as H}from"./vehicle-dc1edebc.js";import{u as K}from"./employee-24f82916.js";import"./useQuery-de5810bc.js";const P=C().shape({operationType:$().required("El tipo de operacion es requerido!"),daysService:k().min(1,"debe ser mayor o igual que 1").required("los dias de servicios son requeridos!"),observations:$().required("La observacion es requerida!"),vehicle:N.required("El vehiculo es requerido!"),employee:N.required("El empleado es requerido!")}),U={operationType:"",daysService:0,observations:""};function _(){const t=Q(),x=Y(),{assigned:e,isLoading:g}=B(),S=f.useMemo(()=>{var r,s,c,i,d,u,y,b;return{daysService:(e==null?void 0:e.daysService)||0,observations:(e==null?void 0:e.observations)||"",operationType:(e==null?void 0:e.operationType)||"",employee:{id:((r=e==null?void 0:e.employee)==null?void 0:r.id)||"",value:((s=e==null?void 0:e.employee)==null?void 0:s.id)||" ",label:`${(c=e==null?void 0:e.employee)==null?void 0:c.identification} - ${(i=e==null?void 0:e.employee)==null?void 0:i.name} ${(d=e==null?void 0:e.employee)==null?void 0:d.lastName}`},vehicle:{id:((u=e==null?void 0:e.vehicle)==null?void 0:u.id)||"",value:((y=e==null?void 0:e.vehicle)==null?void 0:y.id)||"",label:((b=e==null?void 0:e.vehicle)==null?void 0:b.plate)||""}}},[e]),m=w(),a=f.useCallback(async r=>{var s,c;try{await M.editAssignedVehicle(t.id||"",{...r,vehicle:(s=r==null?void 0:r.vehicle)==null?void 0:s.id,employee:(c=r==null?void 0:r.employee)==null?void 0:c.id}),h("Vehiculo actualizado exitosamente",null)}catch(i){h(`opps!! algo no va bien ${i.response.data.message||""}`,"error"),console.error(i)}},[t]),l=f.useCallback(async r=>{var s,c;try{const i=await M.createAssignedVehicle({...r,vehicle:(s=r==null?void 0:r.vehicle)==null?void 0:s.id,employee:(c=r==null?void 0:r.employee)==null?void 0:c.id});return h("Vehiculo creado exitosamente",null),m("/employee/assigned"),i}catch(i){h(`opps!! algo no va bien ${i.response.data.message||""}`,"error"),console.error(i)}},[m]),{mutateAsync:V,isLoading:p}=D(t.id?a:l,{onSuccess:()=>{x.invalidateQueries([I.ASSIGNED])}});return{isLoading:g||p,submit:V,formValues:{defaultValues:t.id?S:U},status:t!=null&&t.id?"Editar assignacion":"Crear assignacion",isEditing:!!t.id}}const ie=()=>{var i,d,u,y,b,E,L,q,j;const{submit:t,isLoading:x,formValues:{defaultValues:e},status:g}=_(),{handleSubmit:S,reset:m,formState:{errors:a},control:l}=O({mode:"all",defaultValues:e,resolver:z(P)});f.useEffect(()=>{m(e)},[m,e]);const V=o=>{t(o)},{vehicles:p,isLoading:r}=H(),{employees:s,isLoading:c}=K();return x||r||c?n.jsx(F,{}):n.jsxs("form",{onSubmit:S(V),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[n.jsx(G,{control:l,name:"daysService",label:"Dias de servicio",type:"number",errorMessage:((i=a.daysService)==null?void 0:i.message)||"",error:!!a.daysService}),n.jsxs("div",{className:"flex gap-4",children:[n.jsx(A,{control:l,name:"vehicle",options:((d=p==null?void 0:p.results)==null?void 0:d.map(o=>({id:o.id,label:o.plate,value:o.id})))||[],errorMessage:((y=(u=a.vehicle)==null?void 0:u.label)==null?void 0:y.message)||"",placeholder:"Vehiculo"}),n.jsx(A,{control:l,name:"employee",options:((b=s==null?void 0:s.results)==null?void 0:b.map(o=>({id:o==null?void 0:o.id,label:`${o==null?void 0:o.identification} - ${o==null?void 0:o.name} ${o==null?void 0:o.lastName}`,value:o==null?void 0:o.id})))||[],errorMessage:((L=(E=a.employee)==null?void 0:E.label)==null?void 0:L.message)||"",placeholder:"Empleado"})]}),n.jsx(T,{control:l,name:"operationType",label:"Tipo de operacion",errorMessage:((q=a.operationType)==null?void 0:q.message)||"",error:!!a.operationType}),n.jsx(T,{control:l,name:"observations",label:"Observaciones",errorMessage:((j=a.observations)==null?void 0:j.message)||"",error:!!a.observations}),n.jsx(R.Button,{type:"submit",className:"mt-10",children:g})]})};export{ie as default};
