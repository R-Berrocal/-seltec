import{v as O,w as V,m as C,y as R,n as T,r as g,d as Y,t as f,p as k,Q as w,a as D,j as n,L as G,c as Q,o as F}from"./index-00a53ffa.js";import{S as E}from"./select-1f413d34.js";import{T as U}from"./text-area-16d274d5.js";import{a as z,H as A}from"./history-005ccf87.js";import{Y as j}from"./validations-c17077ba.js";import{u as B}from"./employee-2f5f3e0b.js";import{u as K}from"./location-b1a7bb59.js";import"./useQuery-400e87ec.js";const P=O().shape({employeeId:j.required("El empleado es requerido!"),locationId:j.required("La locacion es requerido!"),operation:j.required("La operacion es requerida!"),observation:V().required("La observacion es requerida!")}),M=C(),_={observation:"",date:`${M}`};function J(){const d=R(),I=T(),{history:e,isLoading:L}=z(),x=g.useMemo(()=>{var o,i,r,t,a,u,b;return{observation:(e==null?void 0:e.observation)||"",employeeId:{id:((o=e==null?void 0:e.employee)==null?void 0:o.id)||"",value:((i=e==null?void 0:e.employee)==null?void 0:i.id)||"",label:`${(r=e==null?void 0:e.employee)==null?void 0:r.identification} - ${(t=e==null?void 0:e.employee)==null?void 0:t.name} ${(a=e==null?void 0:e.employee)==null?void 0:a.lastName}`||""},locationId:{id:((u=e==null?void 0:e.location)==null?void 0:u.id)||"",value:((b=e==null?void 0:e.location)==null?void 0:b.id)||"",label:(e==null?void 0:e.location.name)||""},operation:{id:(e==null?void 0:e.operation)||"",value:(e==null?void 0:e.operation)||"",label:(e==null?void 0:e.operation)||""}}},[e]),l=Y(),c=g.useCallback(async o=>{var i,r,t;try{await A.editHistory(d.id||"",{...o,employeeId:(i=o==null?void 0:o.employeeId)==null?void 0:i.id,locationId:(r=o==null?void 0:o.locationId)==null?void 0:r.id,operation:(t=o==null?void 0:o.operation)==null?void 0:t.value}),l("/employee/histories"),f("Historial actualizado exitosamente",null)}catch(a){f(`opps!! algo no va bien ${a.response.data.message||""}`,"error"),console.error(a)}},[d,l]),m=g.useCallback(async o=>{var i,r,t;try{const a=await A.createHistory({...o,employeeId:(i=o==null?void 0:o.employeeId)==null?void 0:i.id,locationId:(r=o==null?void 0:o.locationId)==null?void 0:r.id,operation:(t=o==null?void 0:o.operation)==null?void 0:t.value,date:`${M}`});return f("Historial creado exitosamente",null),l("/employee/histories"),a}catch(a){f(`opps!! algo no va bien ${a.response.data.message||""}`,"error"),console.error(a)}},[l]),{mutateAsync:S,isLoading:p}=k(d.id?c:m,{onSuccess:()=>{I.invalidateQueries([w.HISTORY])}});return{isLoading:L||p,submit:S,formValues:{defaultValues:d.id?x:_},status:d.id?"Editar historial":"Crear historial",isEditing:!!d.id}}const W=[{label:"INGRESO",value:"INGRESO",id:"INGRESO"},{label:"SALIDA",value:"SALIDA",id:"SALIDA"}],te=()=>{var t,a,u,b,$,N,H,q,y;const{submit:d,isLoading:I,formValues:{defaultValues:e},status:L}=J(),{handleSubmit:x,reset:l,formState:{errors:c},control:m}=D({mode:"all",defaultValues:e,resolver:F(P)});g.useEffect(()=>{l(e)},[l,e]);const S=s=>{d(s)},{employees:p,isLoading:o}=B(),{locations:i,isLoading:r}=K();return I||o||r?n.jsx(G,{}):n.jsxs("form",{onSubmit:x(S),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[n.jsx(E,{control:m,name:"operation",placeholder:"operacion",options:W,errorMessage:((a=(t=c.operation)==null?void 0:t.value)==null?void 0:a.message)||""}),n.jsx("div",{className:"flex gap-4",children:n.jsx(U,{control:m,name:"observation",label:"Observacion",errorMessage:((u=c.observation)==null?void 0:u.message)||"",error:!!c.observation})}),n.jsxs("div",{className:"flex gap-4",children:[n.jsx(E,{control:m,name:"employeeId",options:((b=p==null?void 0:p.results)==null?void 0:b.map(s=>({id:s.id,label:`${s.identification} - ${s.name} ${s.lastName}`,value:s.id})))||[],errorMessage:((N=($=c.employeeId)==null?void 0:$.label)==null?void 0:N.message)||"",placeholder:"Empleado"}),n.jsx(E,{control:m,name:"locationId",options:((H=i==null?void 0:i.results)==null?void 0:H.map(s=>({id:s.id,label:s.name,value:s.id})))||[],errorMessage:((y=(q=c.locationId)==null?void 0:q.label)==null?void 0:y.message)||"",placeholder:"Locacion"})]}),n.jsx(Q.Button,{type:"submit",className:"mt-10",children:L})]})};export{te as default};
