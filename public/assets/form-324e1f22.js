import{t as T,v as y,y as v,x as Y,n as D,d as P,r as u,q as w,p as $,Q as k,a as Q,j as o,L as z,I as f,c as F,o as B}from"./index-e9c0a00a.js";import{S as h}from"./select-6e8ffeea.js";import{a as G,U as q}from"./user-6cdff1e6.js";import{Y as H}from"./validations-7b33a549.js";import{a as K}from"./company-df997285.js";import"./useQuery-e736bbaf.js";const Z={full_name:"",email:""},J=T().shape({full_name:y().required("El nombre es requerido!"),email:y().required("El email es requerido!"),role:H.required("El rol es requerido!"),password:y().when("email",(l,i)=>window.location.pathname.split("/").includes("create")?i.required("la contrase単a es requerida").matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])/,"la contrasena debe de tener por lo menos un menor, una mayuscula y una minuscula").min(6,"debe de tener por lo menos 6 caracteres"):i),passwordConfirmation:y().oneOf([v("password"),""],"las contrase単as deben ser iguales ").when("password",(l,i)=>l[0].length>0?i.required("requerido"):i)});function W(){const l=Y(),i=D(),m=P(),{user:e,isLoading:C}=G(),x=u.useMemo(()=>{var a,t,r;return{full_name:(e==null?void 0:e.full_name)||"",email:(e==null?void 0:e.email)||"",password:"",phone:(e==null?void 0:e.phone)||"",role:{label:(e==null?void 0:e.role)||"USER",value:(e==null?void 0:e.role)||"USER",id:(e==null?void 0:e.role)||"USER"},company:e!=null&&e.company?{id:((a=e==null?void 0:e.company)==null?void 0:a.id)||"",value:((t=e==null?void 0:e.company)==null?void 0:t.id)||"",label:((r=e==null?void 0:e.company)==null?void 0:r.name)||""}:null,is_deleted:{label:e!=null&&e.is_deleted?"INACTIVO":"ACTIVO",value:e==null?void 0:e.is_deleted,id:(e!=null&&e.is_deleted,"INACTIVO")}}},[e]),b=u.useCallback(async a=>{var t,r,c;try{await q.editUser(l.id||"",{...a,is_deleted:(t=a.is_deleted)==null?void 0:t.value,role:(r=a.role)==null?void 0:r.value,company:((c=a.company)==null?void 0:c.id)||null,password:a!=null&&a.password?a==null?void 0:a.password:void 0}),m("/users"),w("Usuario actualizado exitosamente",null)}catch(d){w(`opps!! algo no va bien ${d.response.data.message||""}`,"error"),console.error(d)}},[l,m]),s=u.useCallback(async a=>{var t,r,c;try{const d=await q.createUser({...a,is_deleted:(t=a.is_deleted)==null?void 0:t.value,role:(r=a.role)==null?void 0:r.value,company:((c=a.company)==null?void 0:c.id)||null,password:a.password});return w("Usuario creado exitosamente",null),m("/users"),d}catch(d){w(`opps!! algo no va bien ${d.response.data.message||""}`,"error"),console.error(d)}},[m]),{mutateAsync:g,isLoading:n}=$(l.id?b:s,{onSuccess:()=>{i.invalidateQueries([k.USER])}});return{isLoading:n||C,submit:g,formValues:{defaultValues:l.id?x:Z},status:l.id?"Editar usuario":"Crear usuario",isEditing:!!l.id}}const X=[{label:"ADMINISTRADOR",value:"ADMIN",id:"ADMIN"},{label:"USUARIO",value:"USER",id:"USER"},{label:"EMPRESA",value:"COMPANY",id:"COMPANY"}],ee=[{label:"ACTIVO",value:!1,id:"ACTIVO"},{label:"INACTIVO",value:!0,id:"INACTIVO"}],ne=()=>{var E,S,A,I,N,_,M,U,O,j,V;const{submit:l,isLoading:i,formValues:{defaultValues:m},status:e,isEditing:C}=W(),{handleSubmit:x,reset:b,formState:{errors:s},watch:g,control:n}=Q({mode:"all",defaultValues:m,resolver:B(J)}),[a,t]=u.useState(!1),{companies:r,isLoading:c}=K();u.useEffect(()=>{const p=g(L=>{var R;((R=L.role)==null?void 0:R.value)==="COMPANY"?t(!0):t(!1)});return()=>p.unsubscribe()},[g]),u.useEffect(()=>{b(m)},[b,m]);const d=p=>{l(p)};return i||c?o.jsx(z,{}):o.jsxs("form",{onSubmit:x(d),autoComplete:"off",className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[o.jsxs("div",{className:"flex gap-4",children:[o.jsx(f,{control:n,name:"full_name",label:"Nombre",errorMessage:((E=s.full_name)==null?void 0:E.message)||"",error:!!s.full_name}),o.jsx(f,{control:n,name:"phone",type:"number",label:"Numero de telefono",errorMessage:((S=s.phone)==null?void 0:S.message)||"",error:!!s.phone})]}),o.jsx(f,{control:n,name:"email",label:"correo electronico",type:"email",errorMessage:((A=s.email)==null?void 0:A.message)||"",error:!!s.email}),o.jsxs("div",{className:"flex gap-4",children:[o.jsx(f,{control:n,name:"password",label:"contrase単a",type:"password",errorMessage:((I=s.password)==null?void 0:I.message)||"",error:!!s.password}),o.jsx(f,{control:n,name:"passwordConfirmation",label:"Confirmar contrase単a",type:"password",errorMessage:((N=s.passwordConfirmation)==null?void 0:N.message)||"",error:!!s.passwordConfirmation})]}),o.jsxs("div",{className:"flex gap-4",children:[o.jsx(h,{control:n,name:"role",options:X,placeholder:"Rol",errorMessage:((M=(_=s.role)==null?void 0:_.label)==null?void 0:M.message)||""}),a&&o.jsx(h,{control:n,name:"company",options:((U=r==null?void 0:r.results)==null?void 0:U.map(p=>({id:p.id,label:p.name,value:p.id})))||[],placeholder:"Empresa",errorMessage:((j=(O=s.company)==null?void 0:O.label)==null?void 0:j.message)||""})]}),C&&o.jsx(h,{control:n,name:"is_deleted",placeholder:"Estado",options:ee,errorMessage:((V=s.is_deleted)==null?void 0:V.message)||""}),o.jsx(F.Button,{type:"submit",className:"mt-10",children:e})]})};export{ne as default};
