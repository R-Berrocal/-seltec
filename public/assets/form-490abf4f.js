import{j as s,C as N,a as b,p as C,q as p,y as M,t as $,g as k,r as h,b as w,i as y,h as Q,v as D,f as I,I as O,w as F}from"./index-9b3c73aa.js";import{S as q}from"./select-e05d9a2c.js";import{Q as G}from"./query-keys-9b3b25cc.js";import{b as R,A as L}from"./assigned-vehicle-5b45b48a.js";import{a as Y}from"./vehicle-b6521f45.js";import{a as z}from"./employee-6241baef.js";const T=({control:i,name:c="",errorMessage:e,...u})=>s.jsxs("div",{className:"flex flex-col w-full",children:[s.jsx(N,{render:({field:n})=>s.jsx(b.Textarea,{...u,...n}),control:i,name:c}),s.jsx(b.Typography,{className:"text-red-400 text-xs italic",children:e})]}),B=C().shape({operationType:p().required("El tipo de operacion es requerido!"),daysService:M().min(1,"debe ser mayor o igual que 1").required("los dias de servicios son requeridos!"),observations:p().required("La observacion es requerida!"),vehicle:p().required("El vehiculo es requerido!"),employee:p().required("El empleado es requerido!")}),H={operationType:"",daysService:0,observations:"",vehicle:"",employee:""};function K(){const i=$(),c=k(),{assigned:e,isLoading:u}=R(),n=h.useMemo(()=>({daysService:(e==null?void 0:e.daysService)||0,employee:(e==null?void 0:e.employee.id)||"",observations:(e==null?void 0:e.observations)||"",operationType:(e==null?void 0:e.operationType)||"",vehicle:(e==null?void 0:e.vehicle.id)||""}),[e]),d=w(),a=h.useCallback(async l=>{try{console.log(l),await L.editAssignedVehicle(i.id||"",l),y("Vehiculo actualizado exitosamente",null)}catch(r){y(`opps!! algo no va bien ${r.response.data.message||""}`,"error"),console.error(r)}},[i]),t=h.useCallback(async l=>{try{console.log(l);const r=await L.createAssignedVehicle(l);return y("Vehiculo creado exitosamente",null),d("/employee/assigned"),r}catch(r){y(`opps!! algo no va bien ${r.response.data.message||""}`,"error"),console.error(r)}},[d]),{mutateAsync:g,isLoading:m}=Q(i.id?a:t,{onSuccess:()=>{c.invalidateQueries([G.ASSIGNED])}});return{isLoading:u||m,submit:g,formValues:{defaultValues:Object.keys(n).length<0?H:n},status:i.id?"Editar assignacion":"Crear assignacion",isEditing:!!i.id}}const Z=()=>{var f,v,x,S,V,j,E;const{submit:i,isLoading:c,formValues:{defaultValues:e},status:u}=K(),{handleSubmit:n,reset:d,formState:{errors:a},control:t}=D({mode:"all",defaultValues:e,resolver:F(B)});h.useEffect(()=>{d(e)},[d,e]);const g=o=>{i(o)},{vehicles:m,isLoading:l}=Y(),{employees:r,isLoading:A}=z();return c||l||A?s.jsx(I,{}):s.jsxs("form",{onSubmit:n(g),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[s.jsx(O,{control:t,name:"daysService",label:"Dias de servicio",type:"number",errorMessage:((f=a.daysService)==null?void 0:f.message)||"",error:!!a.daysService}),s.jsx(T,{control:t,name:"operationType",label:"Tipo de operacion",errorMessage:((v=a.operationType)==null?void 0:v.message)||"",error:!!a.operationType}),s.jsx(T,{control:t,name:"observations",label:"Observaciones",errorMessage:((x=a.observations)==null?void 0:x.message)||"",error:!!a.observations}),s.jsxs("div",{className:"flex gap-4",children:[s.jsx(q,{children:!0,control:t,name:"vehicle",label:"Vehiculo",options:((S=m==null?void 0:m.results)==null?void 0:S.map(o=>({id:o.id,label:o.model,value:o.id})))||[],errorMessage:((V=a.vehicle)==null?void 0:V.message)||"",error:!!a.vehicle,placeholder:"Empleado"}),s.jsx(q,{children:!0,control:t,name:"employee",label:"Empleado",options:((j=r==null?void 0:r.results)==null?void 0:j.map(o=>({id:o.id,label:`${o.name} ${o.lastName}`,value:o.id})))||[],errorMessage:((E=a.employee)==null?void 0:E.message)||"",error:!!a.employee,placeholder:"Vehiculo"})]}),s.jsx(b.Button,{type:"submit",className:"mt-10",children:u})]})};export{Z as default};
