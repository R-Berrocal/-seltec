import{n as R,o as q,p as G,q as B,k as D,u as Q,r as M,b as F,m as y,l as H,s as K,j as a,e as U,I as j,a as _,t as z}from"./index-a20a86ba.js";import{S as Y}from"./select-453db961.js";import{Q as J}from"./query-keys-94b21177.js";import{a as T,E as w}from"./employee-771dc1c5.js";import{Y as I}from"./validations-ba7cc727.js";import{a as W}from"./company-3e46ec56.js";import{u as X}from"./group-d56c92fe.js";import{u as Z}from"./role-955c1541.js";const v=R().shape({name:q().required("El nombre es requerido!"),lastName:q().required("El apellido es requerido!"),email:q().required("El correo electronico es requerido!"),identification:q().required("La identificacion es requerida!"),role:I.required("El rol es requerido!"),groups:G().of(I.required("Los grupos son requeridos!")).required("Los grupos son requeridos!")}),ee={name:"",lastName:"",email:"",identification:"",groups:[]};function re(){const c=B(),h=D(),{employee:e,isLoading:g}=T(),{user:o}=Q(),C=M.useMemo(()=>{var s,u,n,p,m,i,E,x,N,L;return{name:(e==null?void 0:e.name)||"",lastName:(e==null?void 0:e.lastName)||"",email:(e==null?void 0:e.email)||"",identification:(e==null?void 0:e.identification)||"",role:{value:((s=e==null?void 0:e.roleEmployee)==null?void 0:s.id)||"",label:((u=e==null?void 0:e.roleEmployee)==null?void 0:u.name)||"",id:((n=e==null?void 0:e.roleEmployee)==null?void 0:n.id)||""},company:(o==null?void 0:o.role)==="COMPANY"?{label:((p=o.company)==null?void 0:p.id)||"",value:((m=o.company)==null?void 0:m.id)||"",id:((i=o.company)==null?void 0:i.id)||""}:{id:((E=e==null?void 0:e.company)==null?void 0:E.id)||"",label:((x=e==null?void 0:e.company)==null?void 0:x.name)||"",value:((N=e==null?void 0:e.company)==null?void 0:N.id)||""},groups:((L=e==null?void 0:e.groups)==null?void 0:L.map(d=>({label:(d==null?void 0:d.name)||"",id:(d==null?void 0:d.id)||"",value:(d==null?void 0:d.id)||""})))||[]}},[e,o]),f=F(),t=M.useCallback(async s=>{var u,n,p,m;try{await w.editEmployee(c.id||"",{...s,groups:(u=s==null?void 0:s.groups)==null?void 0:u.map(i=>i==null?void 0:i.id),role:(n=s==null?void 0:s.role)==null?void 0:n.value,company:(o==null?void 0:o.role)==="COMPANY"?((p=o.company)==null?void 0:p.id)||"":(m=s==null?void 0:s.company)==null?void 0:m.value}),y("Empleado editado de forma correcta",null)}catch(i){y(`opps!! algo no va bien ${i.response.data.message||""}`,"error"),console.error(i)}},[c,o]),l=M.useCallback(async s=>{var u,n,p;try{const m=await w.createEmployee({...s,groups:s.groups.map(i=>i.id),role:(u=s==null?void 0:s.role)==null?void 0:u.value,company:(o==null?void 0:o.role)==="COMPANY"?((n=o.company)==null?void 0:n.id)||"":(p=s==null?void 0:s.company)==null?void 0:p.value});return y("Empleado creado",null),f("/employee/employees"),m}catch(m){y(`opps!! algo no va bien ${m.response.data.message||""}`,"error"),console.error(m)}},[f,o]),{mutateAsync:b,isLoading:S}=H(c.id?t:l,{onSuccess:()=>{h.invalidateQueries([J.EMPLOYEE])}});return{isLoading:g||S,submit:b,formValues:{defaultValues:c.id?C:ee},status:c.id?"Editar empleado":"Crear empleado",isEditing:!!c.id}}const ce=()=>{var i,E,x,N,L,d,A,O,P,V,k,$;const{user:c}=Q(),{submit:h,isLoading:e,formValues:{defaultValues:g},status:o}=re(),{handleSubmit:C,reset:f,formState:{errors:t},control:l}=K({mode:"all",defaultValues:g,resolver:z(v)}),{companies:b,isLoading:S}=W(),{groups:s,isLoading:u}=X(),{roles:n,isLoading:p}=Z();M.useEffect(()=>{f(g)},[f,g]);const m=r=>{h(r)};return e||S||u||p?a.jsx(U,{}):a.jsxs("form",{onSubmit:C(m),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[a.jsxs("div",{className:"flex gap-4",children:[a.jsx(j,{control:l,name:"name",label:"Nombre",errorMessage:((i=t.name)==null?void 0:i.message)||"",error:!!t.name}),a.jsx(j,{control:l,name:"lastName",label:"Apellido",errorMessage:((E=t.lastName)==null?void 0:E.message)||"",error:!!t.lastName})]}),a.jsxs("div",{className:"flex gap-4",children:[a.jsx(j,{control:l,name:"email",label:"Correo electronico",type:"email",errorMessage:((x=t.email)==null?void 0:x.message)||"",error:!!t.email}),a.jsx(j,{control:l,name:"identification",label:"Identificacion",errorMessage:((N=t.identification)==null?void 0:N.message)||"",error:!!t.identification})]}),(c==null?void 0:c.role)==="ADMIN"&&a.jsx("div",{className:"flex gap-4",children:a.jsx(Y,{control:l,name:"company",options:((L=b==null?void 0:b.results)==null?void 0:L.map(r=>({id:r==null?void 0:r.id,label:r==null?void 0:r.name,value:r==null?void 0:r.id})))||[],placeholder:"Empresa",errorMessage:((A=(d=t.company)==null?void 0:d.label)==null?void 0:A.message)||""})}),a.jsxs("div",{className:"flex gap-4",children:[a.jsx(Y,{control:l,name:"groups",isMulti:!0,options:((O=s==null?void 0:s.results)==null?void 0:O.map(r=>({id:r==null?void 0:r.id,label:r==null?void 0:r.name,value:r==null?void 0:r.id})))||[],placeholder:"Bloque",errorMessage:((P=t.groups)==null?void 0:P.message)||""}),a.jsx(Y,{control:l,name:"role",options:((V=n==null?void 0:n.results)==null?void 0:V.map(r=>({id:r==null?void 0:r.id,label:r==null?void 0:r.name,value:r==null?void 0:r.id})))||[],placeholder:"Cargo",errorMessage:(($=(k=t.role)==null?void 0:k.label)==null?void 0:$.message)||""})]}),a.jsx(_.Button,{type:"submit",className:"mt-10",children:o})]})};export{ce as default};
