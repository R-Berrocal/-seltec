import{v as C,w as $,B as k,y as w,n as Q,r as f,d as Y,t as h,p as D,Q as I,a as O,j as n,L as B,I as F,c as G,o as R}from"./index-8bd41d8c.js";import{S as T}from"./select-bf3dd5aa.js";import{T as A}from"./text-area-cb59dc7e.js";import{a as z,A as M}from"./assigned-vehicle-787146a6.js";import{Y as N}from"./validations-9d99f41c.js";import{u as H}from"./vehicle-a0a4b2b6.js";import{u as K}from"./employee-8e6cc6a7.js";import"./useQuery-d0771aa7.js";const P=C().shape({operationType:$().required("El tipo de operacion es requerido!"),daysService:k().min(1,"debe ser mayor o igual que 1").required("los dias de servicios son requeridos!"),observations:$().required("La observacion es requerida!"),vehicle:N.required("El vehiculo es requerido!"),employee:N.required("El empleado es requerido!")}),U={operationType:"",daysService:0,observations:""};function _(){const t=w(),g=Q(),{assigned:e,isLoading:x}=z(),S=f.useMemo(()=>{var r,s,c,i,d,u,y,b;return{daysService:(e==null?void 0:e.daysService)||0,observations:(e==null?void 0:e.observations)||"",operationType:(e==null?void 0:e.operationType)||"",employee:{id:((r=e==null?void 0:e.employee)==null?void 0:r.id)||"",value:((s=e==null?void 0:e.employee)==null?void 0:s.id)||" ",label:`${(c=e==null?void 0:e.employee)==null?void 0:c.identification} - ${(i=e==null?void 0:e.employee)==null?void 0:i.name} ${(d=e==null?void 0:e.employee)==null?void 0:d.lastName}`},vehicle:{id:((u=e==null?void 0:e.vehicle)==null?void 0:u.id)||"",value:((y=e==null?void 0:e.vehicle)==null?void 0:y.id)||"",label:((b=e==null?void 0:e.vehicle)==null?void 0:b.plate)||""}}},[e]),l=Y(),a=f.useCallback(async r=>{var s,c;try{await M.editAssignedVehicle(t.id||"",{...r,vehicle:(s=r==null?void 0:r.vehicle)==null?void 0:s.id,employee:(c=r==null?void 0:r.employee)==null?void 0:c.id}),l("/employee/assigned"),h("Vehiculo actualizado exitosamente",null)}catch(i){h(`opps!! algo no va bien ${i.response.data.message||""}`,"error"),console.error(i)}},[t,l]),m=f.useCallback(async r=>{var s,c;try{const i=await M.createAssignedVehicle({...r,vehicle:(s=r==null?void 0:r.vehicle)==null?void 0:s.id,employee:(c=r==null?void 0:r.employee)==null?void 0:c.id});return h("Vehiculo creado exitosamente",null),l("/employee/assigned"),i}catch(i){h(`opps!! algo no va bien ${i.response.data.message||""}`,"error"),console.error(i)}},[l]),{mutateAsync:V,isLoading:p}=D(t.id?a:m,{onSuccess:()=>{g.invalidateQueries([I.ASSIGNED])}});return{isLoading:x||p,submit:V,formValues:{defaultValues:t.id?S:U},status:t!=null&&t.id?"Editar assignacion":"Crear assignacion",isEditing:!!t.id}}const ie=()=>{var i,d,u,y,b,E,L,q,j;const{submit:t,isLoading:g,formValues:{defaultValues:e},status:x}=_(),{handleSubmit:S,reset:l,formState:{errors:a},control:m}=O({mode:"all",defaultValues:e,resolver:R(P)});f.useEffect(()=>{l(e)},[l,e]);const V=o=>{t(o)},{vehicles:p,isLoading:r}=H(),{employees:s,isLoading:c}=K();return g||r||c?n.jsx(B,{}):n.jsxs("form",{onSubmit:S(V),className:"bg-white dark:bg-black mt-5 flex flex-col space-y-4",children:[n.jsx(F,{control:m,name:"daysService",label:"Dias de servicio",type:"number",errorMessage:((i=a.daysService)==null?void 0:i.message)||"",error:!!a.daysService}),n.jsxs("div",{className:"flex gap-4",children:[n.jsx(T,{control:m,name:"vehicle",options:((d=p==null?void 0:p.results)==null?void 0:d.map(o=>({id:o.id,label:o.plate,value:o.id})))||[],errorMessage:((y=(u=a.vehicle)==null?void 0:u.label)==null?void 0:y.message)||"",placeholder:"Vehiculo"}),n.jsx(T,{control:m,name:"employee",options:((b=s==null?void 0:s.results)==null?void 0:b.map(o=>({id:o==null?void 0:o.id,label:`${o==null?void 0:o.identification} - ${o==null?void 0:o.name} ${o==null?void 0:o.lastName}`,value:o==null?void 0:o.id})))||[],errorMessage:((L=(E=a.employee)==null?void 0:E.label)==null?void 0:L.message)||"",placeholder:"Empleado"})]}),n.jsx(A,{control:m,name:"operationType",label:"Tipo de operacion",errorMessage:((q=a.operationType)==null?void 0:q.message)||"",error:!!a.operationType}),n.jsx(A,{control:m,name:"observations",label:"Observaciones",errorMessage:((j=a.observations)==null?void 0:j.message)||"",error:!!a.observations}),n.jsx(G.Button,{type:"submit",className:"mt-10",children:x})]})};export{ie as default};
